

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Scanning lockdown &mdash; MetaWards Documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/custom.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Alternative lockdowns" href="07_cutoff.html" />
    <link rel="prev" title="Custom variables" href="05_scanning.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html">
          

          
            
            <img src="../../_static/logo.jpg" class="logo" alt="Logo"/>
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
  <div id="version_box"></div>
</div>


          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../features.html">Features</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../install.html">Installation instructions</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../model_data.html">Model data</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../quickstart/index.html">Quick Start Guide</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Tutorial</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index_part01.html">Part 1 - Modelling outbreaks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index_part02.html">Part 2 - Refining the model</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index_part03.html">Part 3 - Customising the outbreak</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="01_iterators.html">How a day is modelled</a></li>
<li class="toctree-l3"><a class="reference internal" href="02_weekend.html">Where is the weekend?</a></li>
<li class="toctree-l3"><a class="reference internal" href="03_lockdown.html">Custom advance functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="04_dynamic.html">Responding to changing conditions</a></li>
<li class="toctree-l3"><a class="reference internal" href="05_scanning.html">Custom variables</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Scanning lockdown</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#running-on-a-cluster">Running on a cluster</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="07_cutoff.html">Alternative lockdowns</a></li>
<li class="toctree-l3"><a class="reference internal" href="08_local_lockdown.html">Local lockdowns</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../index_part04.html">Part 4 - Customising the output</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index_part05.html">Part 5 - Modelling multiple demographics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index_part06.html">Part 6 - Moving between demographics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index_part07.html">Part 7 - Different pathways for different demographics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index_part08.html">Part 8 - Creating your own models / networks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index_part09.html">Part 9 - Advanced Moves and Scenarios</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../fileformats/index.html">Input files and formats</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cluster_usage.html">Running on a cluster</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../support.html">Help and support</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devsupport.html">Developer Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../roadmap.html">Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../packaging.html">Packaging releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../development.html">Developer’s guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../snaglist.html">Snag list</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">Changelog</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../acknowledgements.html">Acknowledgements</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">MetaWards</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Tutorial</a> &raquo;</li>
        
          <li><a href="../index_part03.html">Part 3 - Customising the outbreak</a> &raquo;</li>
        
      <li>Scanning lockdown</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
    
  </ul>

  
  <div class="rst-breadcrumbs-buttons" role="navigation" aria-label="breadcrumb navigation">
      
        <a href="07_cutoff.html" class="btn btn-neutral float-right" title="Alternative lockdowns" accesskey="n">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
      
      
        <a href="05_scanning.html" class="btn btn-neutral float-left" title="Custom variables" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
      
  </div>
  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="scanning-lockdown">
<h1>Scanning lockdown<a class="headerlink" href="#scanning-lockdown" title="Permalink to this headline">¶</a></h1>
<p>Now that we can create and scan custom variables, we can write a
proper lockdown iterator that enables us to explore different
scenarios.</p>
<p>Create a file called <code class="docutils literal notranslate"><span class="pre">lockdown.inp</span></code> and copy in the below;</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Full lockdown (red)</span>
<span class="o">.</span><span class="n">scale_rate</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.05</span>
<span class="o">.</span><span class="n">can_work</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># Relaxed lockdown (yellow)</span>
<span class="o">.</span><span class="n">scale_rate</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="o">.</span><span class="n">can_work</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># More relaxed lockdown (green)</span>
<span class="o">.</span><span class="n">scale_rate</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="o">.</span><span class="n">can_work</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>  <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
<p>This has defined three lockdown states, ranging from “red” (full lockdown
with strong reduction in transmission rate and working) to
“green” (relaxed lockdown with weaker reduction in transmission rate
and work allowed).</p>
<p>To use this data create an iterator in a file called <code class="docutils literal notranslate"><span class="pre">lockdown.py</span></code> and
copy in the below;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">metawards.iterators</span> <span class="kn">import</span> <span class="n">advance_infprob</span><span class="p">,</span> <span class="n">advance_fixed</span><span class="p">,</span> \
                                <span class="n">advance_play</span><span class="p">,</span> <span class="n">iterate_working_week</span>
<span class="kn">from</span> <span class="nn">metawards.utils</span> <span class="kn">import</span> <span class="n">Console</span>

<span class="k">def</span> <span class="nf">get_lockdown_state</span><span class="p">(</span><span class="n">population</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">population</span><span class="p">,</span> <span class="s2">&quot;lockdown_state&quot;</span><span class="p">):</span>
        <span class="n">population</span><span class="o">.</span><span class="n">lockdown_state</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">population</span><span class="o">.</span><span class="n">is_locked_down</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="n">population</span><span class="o">.</span><span class="n">total</span> <span class="o">&gt;</span> <span class="mi">5000</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">population</span><span class="o">.</span><span class="n">lockdown_state</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">Console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Lockdown started on </span><span class="si">{</span><span class="n">population</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">population</span><span class="o">.</span><span class="n">lockdown_state</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">population</span><span class="o">.</span><span class="n">is_locked_down</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">elif</span> <span class="n">population</span><span class="o">.</span><span class="n">lockdown_state</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">Console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Restarting lockdown on </span><span class="si">{</span><span class="n">population</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">population</span><span class="o">.</span><span class="n">lockdown_state</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">population</span><span class="o">.</span><span class="n">is_locked_down</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">elif</span> <span class="n">population</span><span class="o">.</span><span class="n">total</span> <span class="o">&gt;</span> <span class="mi">3000</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">population</span><span class="o">.</span><span class="n">lockdown_state</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">Console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Re-entering relaxed (yellow) on </span><span class="si">{</span><span class="n">population</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">population</span><span class="o">.</span><span class="n">lockdown_state</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">elif</span> <span class="n">population</span><span class="o">.</span><span class="n">total</span> <span class="o">&lt;</span> <span class="mi">2000</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">population</span><span class="o">.</span><span class="n">lockdown_state</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">Console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Entering relaxed (yellow) on </span><span class="si">{</span><span class="n">population</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">population</span><span class="o">.</span><span class="n">lockdown_state</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">elif</span> <span class="n">population</span><span class="o">.</span><span class="n">total</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">population</span><span class="o">.</span><span class="n">lockdown_state</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">Console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Entering relaxed (green) on </span><span class="si">{</span><span class="n">population</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">population</span><span class="o">.</span><span class="n">lockdown_state</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="k">return</span> <span class="n">population</span><span class="o">.</span><span class="n">lockdown_state</span>

<span class="k">def</span> <span class="nf">advance_lockdown</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">population</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">params</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">get_lockdown_state</span><span class="p">(</span><span class="n">population</span><span class="p">)</span>
    <span class="n">scale_rate</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">user_params</span><span class="p">[</span><span class="s2">&quot;scale_rate&quot;</span><span class="p">][</span><span class="n">state</span><span class="p">]</span>
    <span class="n">can_work</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">user_params</span><span class="p">[</span><span class="s2">&quot;can_work&quot;</span><span class="p">][</span><span class="n">state</span><span class="p">]</span>
    <span class="n">Console</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;State&quot;</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="n">scale_rate</span><span class="p">,</span> <span class="n">can_work</span><span class="p">])</span>

    <span class="n">advance_infprob</span><span class="p">(</span><span class="n">scale_rate</span><span class="o">=</span><span class="n">scale_rate</span><span class="p">,</span>
                    <span class="n">network</span><span class="o">=</span><span class="n">network</span><span class="p">,</span> <span class="n">population</span><span class="o">=</span><span class="n">population</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">advance_play</span><span class="p">(</span><span class="n">network</span><span class="o">=</span><span class="n">network</span><span class="p">,</span> <span class="n">population</span><span class="o">=</span><span class="n">population</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">can_work</span><span class="p">:</span>
        <span class="n">advance_fixed</span><span class="p">(</span><span class="n">network</span><span class="o">=</span><span class="n">network</span><span class="p">,</span> <span class="n">population</span><span class="o">=</span><span class="n">population</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">iterate_custom</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">population</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">params</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">get_lockdown_state</span><span class="p">(</span><span class="n">population</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">population</span><span class="o">.</span><span class="n">is_locked_down</span><span class="p">:</span>
        <span class="n">Console</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Locked down&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">advance_lockdown</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Console</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Normal working week day&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">iterate_working_week</span><span class="p">(</span><span class="n">network</span><span class="o">=</span><span class="n">network</span><span class="p">,</span>
                                    <span class="n">population</span><span class="o">=</span><span class="n">population</span><span class="p">,</span>
                                    <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">get_lockdown_state</span></code> function is the most complex and different.
It uses the number of infecteds (<code class="docutils literal notranslate"><span class="pre">population.total</span></code>) to decide which
<code class="docutils literal notranslate"><span class="pre">lockdown_state</span></code> should be used. This is an integer, with <code class="docutils literal notranslate"><span class="pre">-1</span></code>
meaning no lockdown, <code class="docutils literal notranslate"><span class="pre">0</span></code> being “red”, <code class="docutils literal notranslate"><span class="pre">1</span></code> “yellow” and <code class="docutils literal notranslate"><span class="pre">2</span></code> “green”.</p>
<p>Whether or not the population is locked down is stored in the
<code class="docutils literal notranslate"><span class="pre">population.is_locked_down</span></code> variable. If this is “False” then
<code class="docutils literal notranslate"><span class="pre">iterate_lockdown</span></code> simply returns the result of
<a class="reference internal" href="../../api/generated/metawards.iterators.iterate_working_week.html#metawards.iterators.iterate_working_week" title="metawards.iterators.iterate_working_week"><code class="xref py py-meth docutils literal notranslate"><span class="pre">iterate_working_week()</span></code></a>. Otherwise,
it returns the <code class="docutils literal notranslate"><span class="pre">advance_lockdown</span></code> function that we’ve defined.</p>
<p>This <code class="docutils literal notranslate"><span class="pre">advance_lockdown</span></code> function obtains the <code class="docutils literal notranslate"><span class="pre">scale_rate</span></code> and
<code class="docutils literal notranslate"><span class="pre">can_work</span></code> custom user parameters from the
<a class="reference internal" href="../../api/generated/metawards.Parameters.html#metawards.Parameters" title="metawards.Parameters"><code class="xref py py-class docutils literal notranslate"><span class="pre">Parameters</span></code></a> objects in the model
<a class="reference internal" href="../../api/generated/metawards.Network.html#metawards.Network" title="metawards.Network"><code class="xref py py-class docutils literal notranslate"><span class="pre">Network</span></code></a>.</p>
<p>It calls <a class="reference internal" href="../../api/generated/metawards.iterators.advance_infprob.html#metawards.iterators.advance_infprob" title="metawards.iterators.advance_infprob"><code class="xref py py-meth docutils literal notranslate"><span class="pre">advance_infprob()</span></code></a> with
the set <code class="docutils literal notranslate"><span class="pre">scale_rate</span></code> scaling factor, before calling
<a class="reference internal" href="../../api/generated/metawards.iterators.advance_play.html#metawards.iterators.advance_play" title="metawards.iterators.advance_play"><code class="xref py py-meth docutils literal notranslate"><span class="pre">advance_play()</span></code></a>, and then, if
<code class="docutils literal notranslate"><span class="pre">can_work</span></code> is “True”, <a class="reference internal" href="../../api/generated/metawards.iterators.advance_fixed.html#metawards.iterators.advance_fixed" title="metawards.iterators.advance_fixed"><code class="xref py py-meth docutils literal notranslate"><span class="pre">advance_fixed()</span></code></a>.</p>
<p>Run <code class="docutils literal notranslate"><span class="pre">metawards</span></code> using the below commands and see what you get;</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>metawards -d lurgy3 -a ExtraSeedsLondon.dat  -u lockdown.inp --iterator lockdown --debug
metawards-plot -i output/results.csv.bz2
</pre></div>
</div>
<p>I see;</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ Day 36 ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
                            Normal working week day                     lockdown.py:63
S: 56070689  E: 1663  I: 5889  R: 3836  IW: 1352  POPULATION: 56082077
Number of infections: 7552

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ Day 37 ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Lockdown started on 2020-06-26
                                    Locked down                           lockdown.py:60
                                        State                              lockdown.py:43

        Name │ Value
 ════════════╪═══════
  scale_rate │ 0.05
    can_work │ False

S: 56070608  E: 2118  I: 7192  R: 2159  IW: 80  POPULATION: 56082077
Number of infections: 9310
...
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ Day 51 ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Entering relaxed (yellow) on 2020-07-10
                                    Locked down                           lockdown.py:60
                                        State                              lockdown.py:43

        Name │ Value
 ════════════╪═══════
  scale_rate │ 0.1
    can_work │ False

S: 56069562  E: 36  I: 1518  R: 10961  IW: 55  POPULATION: 56082077
Number of infections: 1554
...
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ Day 55 ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Entering relaxed (green) on 2020-07-14
                                    Locked down                           lockdown.py:60
                                        State                              lockdown.py:43

        Name │ Value
 ════════════╪═══════
  scale_rate │ 0.1
    can_work │ True

S: 56069369  E: 46  I: 852  R: 11810  IW: 59  POPULATION: 56082077
Number of infections: 898
...
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ Day 187 ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
                                    Locked down                           lockdown.py:60
                                        State                              lockdown.py:43

        Name │ Value
 ════════════╪═══════
  scale_rate │ 0.1
    can_work │ True

S: 56068649  E: 0  I: 0  R: 13428  IW: 0  POPULATION: 56082077
Number of infections: 0
Infection died ... Ending on day 188
</pre></div>
</div>
<p>with the overview graph as here;</p>
<img alt="Overview image of a lockdown with custom parameters" src="../../_images/tutorial_3_6_1_overview.jpg" />
<div class="section" id="running-on-a-cluster">
<h2>Running on a cluster<a class="headerlink" href="#running-on-a-cluster" title="Permalink to this headline">¶</a></h2>
<p>Now that this is working, we can scan through lots of different lockdown
scenarios by creating an input file that varies the <code class="docutils literal notranslate"><span class="pre">scale_rate</span></code> and
<code class="docutils literal notranslate"><span class="pre">can_work</span></code> parameters. Create an input file called <code class="docutils literal notranslate"><span class="pre">scan.csv</span></code> and
copy in the following;</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Adjust &quot;red&quot; state from 0.05 to 0.20</span>
<span class="c1"># while adjusting &quot;yellow&quot; from &quot;green&quot; + 0.05 to 0.25</span>
<span class="c1"># while adjusting &quot;green&quot; from &quot;yellow&quot; if working, or</span>
<span class="c1">#                              &quot;yellow&quot; + 0.05 if not</span>

<span class="o">.</span><span class="n">scale_rate</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="o">.</span><span class="n">scale_rate</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="o">.</span><span class="n">scale_rate</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>  <span class="o">.</span><span class="n">can_work</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="c1"># first set allow working in &quot;green&quot;</span>
    <span class="mf">0.05</span>           <span class="mf">0.10</span>            <span class="mf">0.10</span>           <span class="kc">True</span>
    <span class="mf">0.05</span>           <span class="mf">0.15</span>            <span class="mf">0.15</span>           <span class="kc">True</span>
    <span class="mf">0.05</span>           <span class="mf">0.20</span>            <span class="mf">0.20</span>           <span class="kc">True</span>
    <span class="mf">0.05</span>           <span class="mf">0.25</span>            <span class="mf">0.25</span>           <span class="kc">True</span>
    <span class="mf">0.10</span>           <span class="mf">0.15</span>            <span class="mf">0.15</span>           <span class="kc">True</span>
    <span class="mf">0.10</span>           <span class="mf">0.20</span>            <span class="mf">0.20</span>           <span class="kc">True</span>
    <span class="mf">0.10</span>           <span class="mf">0.25</span>            <span class="mf">0.25</span>           <span class="kc">True</span>
    <span class="mf">0.15</span>           <span class="mf">0.20</span>            <span class="mf">0.20</span>           <span class="kc">True</span>
    <span class="mf">0.15</span>           <span class="mf">0.25</span>            <span class="mf">0.25</span>           <span class="kc">True</span>
    <span class="mf">0.20</span>           <span class="mf">0.25</span>            <span class="mf">0.25</span>           <span class="kc">True</span>

<span class="c1"># second set prevent working in &quot;green&quot;</span>
    <span class="mf">0.05</span>           <span class="mf">0.10</span>            <span class="mf">0.15</span>           <span class="kc">False</span>
    <span class="mf">0.05</span>           <span class="mf">0.15</span>            <span class="mf">0.20</span>           <span class="kc">False</span>
    <span class="mf">0.05</span>           <span class="mf">0.20</span>            <span class="mf">0.25</span>           <span class="kc">False</span>
    <span class="mf">0.05</span>           <span class="mf">0.25</span>            <span class="mf">0.30</span>           <span class="kc">False</span>
    <span class="mf">0.10</span>           <span class="mf">0.15</span>            <span class="mf">0.20</span>           <span class="kc">False</span>
    <span class="mf">0.10</span>           <span class="mf">0.20</span>            <span class="mf">0.25</span>           <span class="kc">False</span>
    <span class="mf">0.10</span>           <span class="mf">0.25</span>            <span class="mf">0.30</span>           <span class="kc">False</span>
    <span class="mf">0.15</span>           <span class="mf">0.20</span>            <span class="mf">0.25</span>           <span class="kc">False</span>
    <span class="mf">0.15</span>           <span class="mf">0.25</span>            <span class="mf">0.30</span>           <span class="kc">False</span>
    <span class="mf">0.20</span>           <span class="mf">0.25</span>            <span class="mf">0.30</span>           <span class="kc">False</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note that we have added comments to this file using ‘#’ - these
are useful to help your future self understand what you were doing</p>
</div>
<p>Copy all of the files onto a cluster and submit the job where you
repeat each adjustable variable set 16 times. I used the PBS
job script;</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1">#PBS -l walltime=12:00:00</span>
<span class="c1">#PBS -l select=4:ncpus=64:mem=64GB</span>
<span class="c1"># The above sets 4 nodes with 64 cores each</span>

<span class="c1"># source the version of metawards we want to use</span>
<span class="nb">source</span> <span class="nv">$HOME</span>/envs/metawards-0.8.0/bin/activate

<span class="c1"># change into the directory from which this job was submitted</span>
<span class="nb">cd</span> <span class="nv">$PBS_O_WORKDIR</span>

metawards --additional ExtraSeedsLondon.dat <span class="se">\</span>
        --disease lurgy3 -u lockdown.inp <span class="se">\</span>
        --iterator lockdown <span class="se">\</span>
        --input scan.csv --repeats <span class="m">16</span> --nthreads <span class="m">8</span> <span class="se">\</span>
        --force-overwrite-output
</pre></div>
</div>
<p>Submit your job (e.g. <code class="docutils literal notranslate"><span class="pre">qsub</span> <span class="pre">jobscript.sh</span></code>) and then wait for it to
finish. Once it has completed, generate the overview and average
graphs via;</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>metawards-plot -i output/results.csv.bz2
metawards-plot --animate output/overview*.jpg
metawards-plot --animate output/average*.jpg
</pre></div>
</div>
<p>What do you see?</p>
<p>I get a range of scenarios, from outbreaks that are controlled until
they die out, through oscillating outbreaks where the population is
forever moved between the “green” and “yellow” lockdown states,
through to outbreaks that grow despite lockdown. These can all
be seen here;</p>
<img alt="Overview image of a lockdown with custom parameters" src="../../_images/tutorial_3_6.gif" />
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="07_cutoff.html" class="btn btn-neutral float-right" title="Alternative lockdowns" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="05_scanning.html" class="btn btn-neutral float-left" title="Custom variables" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
      <span class="lastupdated">
        Last updated on Feb 11, 2021.
      </span>

    </p>
  </div> 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>