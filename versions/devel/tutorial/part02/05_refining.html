

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Refining the model &mdash; MetaWards Documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/custom.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Model data" href="06_model_data.html" />
    <link rel="prev" title="Running on a cluster" href="04_cluster.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html">
          

          
            
            <img src="../../_static/logo.jpg" class="logo" alt="Logo"/>
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
  <div id="version_box"></div>
</div>


          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../features.html">Features</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../install.html">Installation instructions</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../model_data.html">Model data</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Tutorial</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index_part01.html">Part 1 - Modelling outbreaks</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index_part02.html">Part 2 - Refining the model</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="01_disease.html">Refining the disease model</a></li>
<li class="toctree-l3"><a class="reference internal" href="02_adjustable.html">Adjustable Variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="03_analysis.html">Analysing the output</a></li>
<li class="toctree-l3"><a class="reference internal" href="04_cluster.html">Running on a cluster</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Refining the model</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#testing-a-hypothesis">Testing a hypothesis</a></li>
<li class="toctree-l4"><a class="reference internal" href="#setting-up-the-job">Setting up the job</a></li>
<li class="toctree-l4"><a class="reference internal" href="#running-the-job">Running the job</a></li>
<li class="toctree-l4"><a class="reference internal" href="#processing-the-output">Processing the output</a></li>
<li class="toctree-l4"><a class="reference internal" href="#conclusion-from-experiment">Conclusion from experiment</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="06_model_data.html">Model data</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../index_part03.html">Part 3 - Customising the outbreak</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index_part04.html">Part 4 - Customising the output</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index_part05.html">Part 5 - Modelling multiple demographics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index_part06.html">Part 6 - Moving between demographics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index_part07.html">Part 7 - Different pathways for different demographics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index_part08.html">Part 8 - Different networks for different demographics</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../fileformats/index.html">Input files and formats</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cluster_usage.html">Running on a cluster</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../support.html">Help and support</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devsupport.html">Developer Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../roadmap.html">Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../packaging.html">Packaging releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../development.html">Developer’s guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../snaglist.html">Snag list</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">Changelog</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../acknowledgements.html">Acknowledgements</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">MetaWards</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Tutorial</a> &raquo;</li>
        
          <li><a href="../index_part02.html">Part 2 - Refining the model</a> &raquo;</li>
        
      <li>Refining the model</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <div class="rst-breadcrumbs-buttons" role="navigation" aria-label="breadcrumb navigation">
      
        <a href="06_model_data.html" class="btn btn-neutral float-right" title="Model data" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="04_cluster.html" class="btn btn-neutral float-left" title="Running on a cluster" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
  </div>
  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="refining-the-model">
<h1>Refining the model<a class="headerlink" href="#refining-the-model" title="Permalink to this headline">¶</a></h1>
<p>You have now run a large number of repeats of lots of different combinations
of the <strong>beta</strong> and <strong>too_ill_to_move</strong> disease parameters of your model
of the lurgy.</p>
<p>Looking at the results, it is clear the greater the value of <strong>beta</strong>,
the larger the outbreak. This makes sense, as <strong>beta</strong> controls the
the rate of infection.</p>
<p>The interpretation for <strong>too_ill_to_move</strong> is less clear. It doesn’t
immediately seem to have a big impact on the size or duration of the
infection.</p>
<div class="section" id="testing-a-hypothesis">
<h2>Testing a hypothesis<a class="headerlink" href="#testing-a-hypothesis" title="Permalink to this headline">¶</a></h2>
<p>One hypothesis why this was the case is because the <strong>progress</strong> parameter,
which represents the rate at which individuals move through our new
stage of the lurgy, was 1.0. This meant that individuals in the model
did not spend long in the infectious (<strong>beta</strong> == 1.0) but mobile and
symptom-free (<strong>too_ill_to_move</strong> == 0.0) state.</p>
<p>The hypothesis is that decreasing the rate at which individuals move
through this state should increase the outbreak as they will have more
time to unknowingly spread the infection.</p>
<p>To test this hypothesis, we can create a new set of adjustable variables
in which we vary <strong>progress</strong> as well as <strong>beta</strong> and <strong>too_ill_to_move</strong>.</p>
</div>
<div class="section" id="setting-up-the-job">
<h2>Setting up the job<a class="headerlink" href="#setting-up-the-job" title="Permalink to this headline">¶</a></h2>
<p>Create a new directory on your cluster and copy in your <code class="docutils literal notranslate"><span class="pre">lurgy2.json</span></code>
disease file. Then create a new script called <code class="docutils literal notranslate"><span class="pre">create_params.py</span></code> and
copy into this;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>

<span class="n">b0</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">b1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">bdel</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>

<span class="n">i0</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
<span class="n">i1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
<span class="n">idel</span> <span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>

<span class="n">p0</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span>
<span class="n">p1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">8</span><span class="p">])</span>
<span class="n">pdel</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">9</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;beta[2]  too_ill_to_move[2]  progress[2]&quot;</span><span class="p">)</span>

<span class="n">b</span> <span class="o">=</span> <span class="n">b0</span>
<span class="k">while</span> <span class="n">b</span> <span class="o">&lt;=</span> <span class="n">b1</span><span class="p">:</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">i0</span>
    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">i1</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">p0</span>
        <span class="k">while</span> <span class="n">p</span> <span class="o">&lt;=</span> <span class="n">p1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  </span><span class="si">%.2f</span><span class="s2">     </span><span class="si">%.2f</span><span class="s2">    </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span><span class="p">))</span>
            <span class="n">p</span> <span class="o">+=</span> <span class="n">pdel</span>

        <span class="n">i</span> <span class="o">+=</span> <span class="n">idel</span>
    <span class="n">b</span> <span class="o">+=</span> <span class="n">bdel</span>
</pre></div>
</div>
<p>Run this script using;</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python create_params.py <span class="m">0</span>.4 <span class="m">0</span>.71 <span class="m">0</span>.1 <span class="m">0</span>.0 <span class="m">0</span>.5 <span class="m">0</span>.1 <span class="m">0</span>.2 <span class="m">0</span>.81 <span class="m">0</span>.2 &gt; lurgyparams.csv
</pre></div>
</div>
<p>This will create a set of adjustable variable sets for <em>model runs</em> that
vary <strong>beta</strong> between 0.4 and 0.7 in steps of 0.1,
<strong>too_ill_to_move</strong> between 0.0 and 0.5 in steps of 0.1, and
<strong>progress</strong> between 0.2 and 0.8 in steps of 0.2.</p>
<p>The first few lines of this file are shown below;</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">beta</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>  <span class="n">too_ill_to_move</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>  <span class="n">progress</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
  <span class="mf">0.40</span>     <span class="mf">0.00</span>    <span class="mf">0.20</span>
  <span class="mf">0.40</span>     <span class="mf">0.00</span>    <span class="mf">0.40</span>
  <span class="mf">0.40</span>     <span class="mf">0.00</span>    <span class="mf">0.60</span>
  <span class="mf">0.40</span>     <span class="mf">0.00</span>    <span class="mf">0.80</span>
  <span class="mf">0.40</span>     <span class="mf">0.10</span>    <span class="mf">0.20</span>
  <span class="mf">0.40</span>     <span class="mf">0.10</span>    <span class="mf">0.40</span>
  <span class="mf">0.40</span>     <span class="mf">0.10</span>    <span class="mf">0.60</span>
  <span class="mf">0.40</span>     <span class="mf">0.10</span>    <span class="mf">0.80</span>
  <span class="mf">0.40</span>     <span class="mf">0.20</span>    <span class="mf">0.20</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The file is space-separated, so it is not a problem that the columns
don’t line up with their titles. With a little more python you could
make them line up. What approach would you take?</p>
</div>
</div>
<div class="section" id="running-the-job">
<h2>Running the job<a class="headerlink" href="#running-the-job" title="Permalink to this headline">¶</a></h2>
<p>You can now submit this job using a copy of the job script that you used
before. For example, I used;</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1">#PBS -l walltime=12:00:00</span>
<span class="c1">#PBS -l select=4:ncpus=64:mem=64GB</span>

<span class="c1"># source the version of metawards we want to use</span>
<span class="nb">source</span> <span class="nv">$HOME</span>/envs/metawards-devel/bin/activate

<span class="c1"># change into the directory from which this job was submitted</span>
<span class="nb">cd</span> <span class="nv">$PBS_O_WORKDIR</span>

<span class="nb">export</span> <span class="nv">METAWARDS_CORES_PER_NODE</span><span class="o">=</span><span class="s2">&quot;64&quot;</span>
<span class="nb">export</span> <span class="nv">METAWARDSDATA</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/GitHub/MetaWardsData&quot;</span>

metawards --additional ExtraSeedsLondon.dat <span class="se">\</span>
          --disease lurgy2.json <span class="se">\</span>
          --input lurgyparams.csv --repeats <span class="m">16</span> --nthreads <span class="m">8</span> <span class="se">\</span>
          --force-overwrite-output
</pre></div>
</div>
<p>I submitted usig the command;</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>qsub jobscript.sh
</pre></div>
</div>
</div>
<div class="section" id="processing-the-output">
<h2>Processing the output<a class="headerlink" href="#processing-the-output" title="Permalink to this headline">¶</a></h2>
<p>The job will take a while. In my case, the job took 2 hours to run.
Once complete, the <code class="docutils literal notranslate"><span class="pre">results.csv.bz2</span></code> file contains all of the
population trajectories and can be analysed in an identical way
as before. If you want, you can
<a class="reference download internal" download="" href="../../_downloads/5a44c0e178c83875f58aadb34b8b75ba/results.csv.bz2"><code class="xref download docutils literal notranslate"><span class="pre">my</span> <span class="pre">results.csv.bz2</span> <span class="pre">file</span> <span class="pre">here</span></code></a>.</p>
<p>You can then produce graphs and animations using;</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>metawards-plot -i output/results.csv.bz2 --format jpg --dpi <span class="m">150</span>
metawards-plot --animate output/overview*.jpg
</pre></div>
</div>
<p>The resulting animation of the overview plots is shown below.</p>
<img alt="Overview animation of the outbreak of the lurgy" src="../../_images/tutorial_2_5.gif" />
</div>
<div class="section" id="conclusion-from-experiment">
<h2>Conclusion from experiment<a class="headerlink" href="#conclusion-from-experiment" title="Permalink to this headline">¶</a></h2>
<p>It is clear from these graphs that the rate of progress through the new
stage of the lurgy we added has an impact on the form of the
outbreak. The lower value of <strong>progress</strong> in the new infectious and
asymptomatic stage leads to a wider outbreak that moves more quickly
through the population.</p>
<p>The (fictional) lurgy is a mild and mildly infectious disease that doesn’t
cause too many symptoms. From the graphs, it is clear that this is best
modelled using a low value of <strong>beta</strong> and a low value of <strong>progress</strong>
for the new stage we added. We will leave the value of
<strong>too_ill_to_move</strong> at 0.0 to capture asymptomatic nature of this
stage. With this choice made,
please create a new version of the lurgy disease parameters called
<code class="docutils literal notranslate"><span class="pre">lurgy3.json</span></code> and copy in the below;</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;name&quot;</span>             <span class="p">:</span> <span class="s2">&quot;The Lurgy&quot;</span><span class="p">,</span>
  <span class="s2">&quot;version&quot;</span>          <span class="p">:</span> <span class="s2">&quot;April 17th 2020&quot;</span><span class="p">,</span>
  <span class="s2">&quot;author(s)&quot;</span>        <span class="p">:</span> <span class="s2">&quot;Christopher Woods&quot;</span><span class="p">,</span>
  <span class="s2">&quot;contact(s)&quot;</span>       <span class="p">:</span> <span class="s2">&quot;christopher.woods@bristol.ac.uk&quot;</span><span class="p">,</span>
  <span class="s2">&quot;reference(s)&quot;</span>     <span class="p">:</span> <span class="s2">&quot;Completely ficticious disease - no references&quot;</span><span class="p">,</span>
  <span class="s2">&quot;beta&quot;</span>             <span class="p">:</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
  <span class="s2">&quot;progress&quot;</span>         <span class="p">:</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
  <span class="s2">&quot;too_ill_to_move&quot;</span>  <span class="p">:</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
  <span class="s2">&quot;contrib_foi&quot;</span>      <span class="p">:</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Once you have this, verify that you can run a <code class="docutils literal notranslate"><span class="pre">metawards</span></code> simulation,
and then plot the graphs using;</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>metawards -d lurgy3.json --additional ExtraSeedsLondon.dat
metawards-plot -i output/results.csv --format jpg --dpi <span class="m">150</span>
</pre></div>
</div>
<p>If it works, then you should obtain a graph that looks something like this;</p>
<img alt="Overview from a run using the refined parameters" src="../../_images/tutorial_2_5_2.jpg" />
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Remember that this is a completely fictional disease and is not
related to any real outbreak. The graphs above are purely
illustrative and chosen so that people following this tutorial
can quickly see the impact of their work.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="06_model_data.html" class="btn btn-neutral float-right" title="Model data" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="04_cluster.html" class="btn btn-neutral float-left" title="Running on a cluster" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
      <span class="lastupdated">
        Last updated on Jul 13, 2020.
      </span>

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>