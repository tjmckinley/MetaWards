

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Staying under quarantine &mdash; MetaWards Documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/custom.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Part 7 - Different pathways for different demographics" href="../index_part07.html" />
    <link rel="prev" title="Conditional Compliance" href="04_compliance.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html">
          

          
            
            <img src="../../_static/logo.jpg" class="logo" alt="Logo"/>
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
  <div id="version_box"></div>
</div>


          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../features.html">Features</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../install.html">Installation instructions</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../model_data.html">Model data</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Tutorial</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index_part01.html">Part 1 - Modelling outbreaks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index_part02.html">Part 2 - Refining the model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index_part03.html">Part 3 - Customising the outbreak</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index_part04.html">Part 4 - Customising the output</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index_part05.html">Part 5 - Modelling multiple demographics</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index_part06.html">Part 6 - Moving between demographics</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="01_movers.html">Movers and go functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="02_duration.html">Self-isolation duration</a></li>
<li class="toctree-l3"><a class="reference internal" href="03_scan_duration.html">How many days of self-isolation is needed?</a></li>
<li class="toctree-l3"><a class="reference internal" href="04_compliance.html">Conditional Compliance</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Staying under quarantine</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#go-early-functions">go_early functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#scanning-quarantine">Scanning quarantine</a></li>
<li class="toctree-l4"><a class="reference internal" href="#analysis">Analysis</a></li>
<li class="toctree-l4"><a class="reference internal" href="#reflections-on-results">Reflections on results</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../index_part07.html">Part 7 - Different pathways for different demographics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index_part08.html">Part 8 - Different networks for different demographics</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../fileformats/index.html">Input files and formats</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cluster_usage.html">Running on a cluster</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../support.html">Help and support</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devsupport.html">Developer Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../roadmap.html">Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../packaging.html">Packaging releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../development.html">Developer’s guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../snaglist.html">Snag list</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">Changelog</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../acknowledgements.html">Acknowledgements</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">MetaWards</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Tutorial</a> &raquo;</li>
        
          <li><a href="../index_part06.html">Part 6 - Moving between demographics</a> &raquo;</li>
        
      <li>Staying under quarantine</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <div class="rst-breadcrumbs-buttons" role="navigation" aria-label="breadcrumb navigation">
      
        <a href="../index_part07.html" class="btn btn-neutral float-right" title="Part 7 - Different pathways for different demographics" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="04_compliance.html" class="btn btn-neutral float-left" title="Conditional Compliance" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
  </div>
  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="staying-under-quarantine">
<h1>Staying under quarantine<a class="headerlink" href="#staying-under-quarantine" title="Permalink to this headline">¶</a></h1>
<p>From the previous page, we saw that at least 90% of individuals needed to
comply with self-isolation to limit the outbreak.
However, that run assumed that everyone who entered self-isolation remained
quarantined for the full seven days. It is important that we also model
the impact of individuals breaking quarantine early.</p>
<div class="section" id="go-early-functions">
<h2>go_early functions<a class="headerlink" href="#go-early-functions" title="Permalink to this headline">¶</a></h2>
<p>We can represent a fraction of individuals
leaving quarantine early each day by passing the keyword
argument <code class="docutils literal notranslate"><span class="pre">fraction</span></code> to
<a class="reference internal" href="../../api/generated/metawards.movers.go_to.html#metawards.movers.go_to" title="metawards.movers.go_to"><code class="xref py py-meth docutils literal notranslate"><span class="pre">go_to()</span></code></a>. Do this by updating your
<code class="docutils literal notranslate"><span class="pre">move_isolate.py</span></code> to read;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">metawards</span> <span class="kn">import</span> <span class="n">Population</span>
<span class="kn">from</span> <span class="nn">metawards</span> <span class="kn">import</span> <span class="n">Networks</span>
<span class="kn">from</span> <span class="nn">metawards.movers</span> <span class="kn">import</span> <span class="n">go_isolate</span><span class="p">,</span> <span class="n">go_to</span>

<span class="k">def</span> <span class="nf">move_isolate</span><span class="p">(</span><span class="n">network</span><span class="p">:</span> <span class="n">Networks</span><span class="p">,</span> <span class="n">population</span><span class="p">:</span> <span class="n">Population</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">user_params</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">user_params</span>

    <span class="n">ndays</span> <span class="o">=</span> <span class="mi">7</span>
    <span class="n">isolate_stage</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">compliance_fraction</span> <span class="o">=</span> <span class="mf">0.9</span>

    <span class="c1"># fraction who remain in isolation, counting from the longest to</span>
    <span class="c1"># shortest stay in isolation.</span>
    <span class="n">remain</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> <span class="mf">1.00</span><span class="p">,</span> <span class="mf">1.00</span><span class="p">]</span>

    <span class="n">day</span> <span class="o">=</span> <span class="n">population</span><span class="o">.</span><span class="n">day</span> <span class="o">%</span> <span class="mi">7</span>
    <span class="n">isolate</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;isolate_</span><span class="si">{</span><span class="n">day</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="n">go_early</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># have to define this functions one-by-one and not in a loop</span>
    <span class="c1"># otherwise python will bind all functions to the value of i</span>
    <span class="c1"># of the last iteration of the loop</span>
    <span class="n">go_early</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="k">lambda</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">go_to</span><span class="p">(</span>
                            <span class="n">go_from</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;isolate_</span><span class="si">{</span><span class="p">(</span><span class="n">day</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">7</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="n">go_to</span><span class="o">=</span><span class="s2">&quot;released&quot;</span><span class="p">,</span>
                            <span class="n">fraction</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">remain</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                            <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
    <span class="n">go_early</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="k">lambda</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">go_to</span><span class="p">(</span>
                            <span class="n">go_from</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;isolate_</span><span class="si">{</span><span class="p">(</span><span class="n">day</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">%</span> <span class="mi">7</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="n">go_to</span><span class="o">=</span><span class="s2">&quot;released&quot;</span><span class="p">,</span>
                            <span class="n">fraction</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">remain</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                            <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
    <span class="n">go_early</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="k">lambda</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">go_to</span><span class="p">(</span>
                            <span class="n">go_from</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;isolate_</span><span class="si">{</span><span class="p">(</span><span class="n">day</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="o">%</span> <span class="mi">7</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="n">go_to</span><span class="o">=</span><span class="s2">&quot;released&quot;</span><span class="p">,</span>
                            <span class="n">fraction</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">remain</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
                            <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
    <span class="n">go_early</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="k">lambda</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">go_to</span><span class="p">(</span>
                            <span class="n">go_from</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;isolate_</span><span class="si">{</span><span class="p">(</span><span class="n">day</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span> <span class="o">%</span> <span class="mi">7</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="n">go_to</span><span class="o">=</span><span class="s2">&quot;released&quot;</span><span class="p">,</span>
                            <span class="n">fraction</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">remain</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span>
                            <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
    <span class="n">go_early</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="k">lambda</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">go_to</span><span class="p">(</span>
                            <span class="n">go_from</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;isolate_</span><span class="si">{</span><span class="p">(</span><span class="n">day</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span> <span class="o">%</span> <span class="mi">7</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="n">go_to</span><span class="o">=</span><span class="s2">&quot;released&quot;</span><span class="p">,</span>
                            <span class="n">fraction</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">remain</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span>
                            <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
    <span class="n">go_early</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="k">lambda</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">go_to</span><span class="p">(</span>
                            <span class="n">go_from</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;isolate_</span><span class="si">{</span><span class="p">(</span><span class="n">day</span> <span class="o">+</span> <span class="mi">6</span><span class="p">)</span> <span class="o">%</span> <span class="mi">7</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="n">go_to</span><span class="o">=</span><span class="s2">&quot;released&quot;</span><span class="p">,</span>
                            <span class="n">fraction</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">remain</span><span class="p">[</span><span class="mi">5</span><span class="p">]),</span>
                            <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>

    <span class="n">go_isolate_day</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">go_isolate</span><span class="p">(</span>
                                        <span class="n">go_from</span><span class="o">=</span><span class="s2">&quot;home&quot;</span><span class="p">,</span>
                                        <span class="n">go_to</span><span class="o">=</span><span class="n">isolate</span><span class="p">,</span>
                                        <span class="n">self_isolate_stage</span><span class="o">=</span><span class="n">isolate_stage</span><span class="p">,</span>
                                        <span class="n">fraction</span><span class="o">=</span><span class="n">compliance_fraction</span><span class="p">,</span>
                                        <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">go_released</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">go_to</span><span class="p">(</span><span class="n">go_from</span><span class="o">=</span><span class="n">isolate</span><span class="p">,</span>
                                        <span class="n">go_to</span><span class="o">=</span><span class="s2">&quot;released&quot;</span><span class="p">,</span>
                                        <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">go_early</span> <span class="o">+</span> <span class="p">[</span><span class="n">go_released</span><span class="p">,</span> <span class="n">go_isolate_day</span><span class="p">]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It would be nicer and less error-prone if we could create the
<code class="docutils literal notranslate"><span class="pre">go_early</span></code> functions in a loop. However, this would not work
because of the way that Python lambda functions bind their arguments.
If we did this, the arguments from the last iteration of the loop
would be used for all of the <code class="docutils literal notranslate"><span class="pre">go_early</span></code> functions, i.e. we would
try to move individuals out of the same <code class="docutils literal notranslate"><span class="pre">isolate_N</span></code> demographic
six times.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Note that we’ve set <code class="docutils literal notranslate"><span class="pre">compliance</span></code> to 0.9 based on the results of the
last scan.</p>
</div>
<p>Here, we’ve created a new set of go functions called <code class="docutils literal notranslate"><span class="pre">go_release_early</span></code>.
There is one for each <code class="docutils literal notranslate"><span class="pre">isolate_N</span></code> demographic <em>except</em> for the
demographic to which individuals will be moved on each day.</p>
<p>This <code class="docutils literal notranslate"><span class="pre">go_release_early</span></code> function moves a fraction of individuals from
the <code class="docutils literal notranslate"><span class="pre">isolate_N</span></code> demographic to <code class="docutils literal notranslate"><span class="pre">released</span></code>, representing that fraction
breaking their quarantine early. This fraction is taken from the list
<code class="docutils literal notranslate"><span class="pre">remain</span></code>, which counts up from <code class="docutils literal notranslate"><span class="pre">0.90</span></code> to <code class="docutils literal notranslate"><span class="pre">1.00</span></code>. The first value
(<code class="docutils literal notranslate"><span class="pre">0.90</span></code>) is the fraction for individuals that have been isolating the longest
(six days), and that will remain in isolation that day (i.e. 90% will remain,
while 10% will break quarantine early). The last value (<code class="docutils literal notranslate"><span class="pre">1.00</span></code>) is the
fraction for the individuals who only entered isolation the previous day,
i.e. everyone remains in isolation for at least one day. These <code class="docutils literal notranslate"><span class="pre">go_early</span></code>
functions are then added before <code class="docutils literal notranslate"><span class="pre">go_released</span></code> and <code class="docutils literal notranslate"><span class="pre">go_isolate_day</span></code>.</p>
<p>Now run <code class="docutils literal notranslate"><span class="pre">metawards</span></code> using your <code class="docutils literal notranslate"><span class="pre">move_isolate.py</span></code> via;</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>metawards -d lurgy4 -D demographics.json -a ExtraSeedsLondon.dat --mixer mix_isolate --mover move_isolate --nsteps <span class="m">365</span>
</pre></div>
</div>
<p>You should see that the disease spreads, now both from individuals who
choose not to self-isolate, and now also from individuals who break
their quarantine early. Graphing the output via;</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>metawards-plot -i output/results.csv.bz2
</pre></div>
</div>
<p>gives an overview plot that should look something like;</p>
<img alt="Effect of compliance of remaining in quarantine" src="../../_images/tutorial_6_5_1.jpg" />
<p>It is clear that individuals who break quarantine early contribute
significantly to further spread of the outbreak (&gt; 14 million have
experienced infection after one year in this <em>model run</em> compared
to ~6 million if all individuals strictly observed the full seven
days of quarantine).</p>
</div>
<div class="section" id="scanning-quarantine">
<h2>Scanning quarantine<a class="headerlink" href="#scanning-quarantine" title="Permalink to this headline">¶</a></h2>
<p>The next step is to scan through different compliance levels for
different numbers of days. To do this, update your
<code class="docutils literal notranslate"><span class="pre">move_isolate.py</span></code> to read;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">metawards</span> <span class="kn">import</span> <span class="n">Population</span>
<span class="kn">from</span> <span class="nn">metawards</span> <span class="kn">import</span> <span class="n">Networks</span>
<span class="kn">from</span> <span class="nn">metawards.movers</span> <span class="kn">import</span> <span class="n">go_isolate</span><span class="p">,</span> <span class="n">go_to</span>

<span class="k">def</span> <span class="nf">move_isolate</span><span class="p">(</span><span class="n">network</span><span class="p">:</span> <span class="n">Networks</span><span class="p">,</span> <span class="n">population</span><span class="p">:</span> <span class="n">Population</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">user_params</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">user_params</span>

    <span class="n">ndays</span> <span class="o">=</span> <span class="mi">7</span>
    <span class="n">isolate_stage</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">compliance_fraction</span> <span class="o">=</span> <span class="mf">0.9</span>

    <span class="c1"># fraction who remain in isolation, counting from the longest to</span>
    <span class="c1"># shortest stay in isolation.</span>
    <span class="n">remain</span> <span class="o">=</span> <span class="n">user_params</span><span class="p">[</span><span class="s2">&quot;remain&quot;</span><span class="p">]</span>

    <span class="n">day</span> <span class="o">=</span> <span class="n">population</span><span class="o">.</span><span class="n">day</span> <span class="o">%</span> <span class="mi">7</span>
    <span class="n">isolate</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;isolate_</span><span class="si">{</span><span class="n">day</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="n">go_early</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># have to define this functions one-by-one and not in a loop</span>
    <span class="c1"># otherwise python will bind all functions to the value of i</span>
    <span class="c1"># of the last iteration of the loop</span>
    <span class="n">go_early</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="k">lambda</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">go_to</span><span class="p">(</span>
                            <span class="n">go_from</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;isolate_</span><span class="si">{</span><span class="p">(</span><span class="n">day</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">7</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="n">go_to</span><span class="o">=</span><span class="s2">&quot;released&quot;</span><span class="p">,</span>
                            <span class="n">fraction</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">remain</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                            <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
    <span class="n">go_early</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="k">lambda</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">go_to</span><span class="p">(</span>
                            <span class="n">go_from</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;isolate_</span><span class="si">{</span><span class="p">(</span><span class="n">day</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">%</span> <span class="mi">7</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="n">go_to</span><span class="o">=</span><span class="s2">&quot;released&quot;</span><span class="p">,</span>
                            <span class="n">fraction</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">remain</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                            <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
    <span class="n">go_early</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="k">lambda</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">go_to</span><span class="p">(</span>
                            <span class="n">go_from</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;isolate_</span><span class="si">{</span><span class="p">(</span><span class="n">day</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="o">%</span> <span class="mi">7</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="n">go_to</span><span class="o">=</span><span class="s2">&quot;released&quot;</span><span class="p">,</span>
                            <span class="n">fraction</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">remain</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
                            <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
    <span class="n">go_early</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="k">lambda</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">go_to</span><span class="p">(</span>
                            <span class="n">go_from</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;isolate_</span><span class="si">{</span><span class="p">(</span><span class="n">day</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span> <span class="o">%</span> <span class="mi">7</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="n">go_to</span><span class="o">=</span><span class="s2">&quot;released&quot;</span><span class="p">,</span>
                            <span class="n">fraction</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">remain</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span>
                            <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
    <span class="n">go_early</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="k">lambda</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">go_to</span><span class="p">(</span>
                            <span class="n">go_from</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;isolate_</span><span class="si">{</span><span class="p">(</span><span class="n">day</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span> <span class="o">%</span> <span class="mi">7</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="n">go_to</span><span class="o">=</span><span class="s2">&quot;released&quot;</span><span class="p">,</span>
                            <span class="n">fraction</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">remain</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span>
                            <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
    <span class="n">go_early</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="k">lambda</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">go_to</span><span class="p">(</span>
                            <span class="n">go_from</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;isolate_</span><span class="si">{</span><span class="p">(</span><span class="n">day</span> <span class="o">+</span> <span class="mi">6</span><span class="p">)</span> <span class="o">%</span> <span class="mi">7</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="n">go_to</span><span class="o">=</span><span class="s2">&quot;released&quot;</span><span class="p">,</span>
                            <span class="n">fraction</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">remain</span><span class="p">[</span><span class="mi">5</span><span class="p">]),</span>
                            <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>

    <span class="n">go_isolate_day</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">go_isolate</span><span class="p">(</span>
                                        <span class="n">go_from</span><span class="o">=</span><span class="s2">&quot;home&quot;</span><span class="p">,</span>
                                        <span class="n">go_to</span><span class="o">=</span><span class="n">isolate</span><span class="p">,</span>
                                        <span class="n">self_isolate_stage</span><span class="o">=</span><span class="n">isolate_stage</span><span class="p">,</span>
                                        <span class="n">fraction</span><span class="o">=</span><span class="n">compliance_fraction</span><span class="p">,</span>
                                        <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">go_released</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">go_to</span><span class="p">(</span><span class="n">go_from</span><span class="o">=</span><span class="n">isolate</span><span class="p">,</span>
                                        <span class="n">go_to</span><span class="o">=</span><span class="s2">&quot;released&quot;</span><span class="p">,</span>
                                        <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">go_early</span> <span class="o">+</span> <span class="p">[</span><span class="n">go_released</span><span class="p">,</span> <span class="n">go_isolate_day</span><span class="p">]</span>
</pre></div>
</div>
<p>The only change is that we now read the <code class="docutils literal notranslate"><span class="pre">remain</span></code> list from the
custom user variable called <code class="docutils literal notranslate"><span class="pre">remain</span></code>.</p>
<p>Create a scan file called <code class="docutils literal notranslate"><span class="pre">scan_remain.dat</span></code> and copy in the below;</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">.</span><span class="n">remain</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="o">.</span><span class="n">remain</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="o">.</span><span class="n">remain</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>  <span class="o">.</span><span class="n">remain</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>  <span class="o">.</span><span class="n">remain</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>  <span class="o">.</span><span class="n">remain</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
   <span class="mf">1.00</span>        <span class="mf">1.00</span>        <span class="mf">1.00</span>        <span class="mf">1.00</span>        <span class="mf">1.00</span>        <span class="mf">1.00</span>

   <span class="mf">0.95</span>        <span class="mf">1.00</span>        <span class="mf">1.00</span>        <span class="mf">1.00</span>        <span class="mf">1.00</span>        <span class="mf">1.00</span>
   <span class="mf">0.95</span>        <span class="mf">0.95</span>        <span class="mf">1.00</span>        <span class="mf">1.00</span>        <span class="mf">1.00</span>        <span class="mf">1.00</span>
   <span class="mf">0.95</span>        <span class="mf">0.95</span>        <span class="mf">0.95</span>        <span class="mf">1.00</span>        <span class="mf">1.00</span>        <span class="mf">1.00</span>
   <span class="mf">0.95</span>        <span class="mf">0.95</span>        <span class="mf">0.95</span>        <span class="mf">0.95</span>        <span class="mf">1.00</span>        <span class="mf">1.00</span>
   <span class="mf">0.95</span>        <span class="mf">0.95</span>        <span class="mf">0.95</span>        <span class="mf">0.95</span>        <span class="mf">0.95</span>        <span class="mf">1.00</span>
   <span class="mf">0.95</span>        <span class="mf">0.95</span>        <span class="mf">0.95</span>        <span class="mf">0.95</span>        <span class="mf">0.95</span>        <span class="mf">0.95</span>

   <span class="mf">0.90</span>        <span class="mf">0.95</span>        <span class="mf">0.95</span>        <span class="mf">0.95</span>        <span class="mf">0.95</span>        <span class="mf">0.95</span>
   <span class="mf">0.90</span>        <span class="mf">0.90</span>        <span class="mf">0.95</span>        <span class="mf">0.95</span>        <span class="mf">0.95</span>        <span class="mf">0.95</span>
   <span class="mf">0.90</span>        <span class="mf">0.90</span>        <span class="mf">0.90</span>        <span class="mf">0.95</span>        <span class="mf">0.95</span>        <span class="mf">0.95</span>
   <span class="mf">0.90</span>        <span class="mf">0.90</span>        <span class="mf">0.90</span>        <span class="mf">0.90</span>        <span class="mf">0.95</span>        <span class="mf">0.95</span>
   <span class="mf">0.90</span>        <span class="mf">0.90</span>        <span class="mf">0.90</span>        <span class="mf">0.90</span>        <span class="mf">0.90</span>        <span class="mf">0.95</span>
   <span class="mf">0.90</span>        <span class="mf">0.90</span>        <span class="mf">0.90</span>        <span class="mf">0.90</span>        <span class="mf">0.90</span>        <span class="mf">0.90</span>

   <span class="mf">0.85</span>        <span class="mf">0.90</span>        <span class="mf">0.90</span>        <span class="mf">0.90</span>        <span class="mf">0.90</span>        <span class="mf">0.90</span>
   <span class="mf">0.85</span>        <span class="mf">0.85</span>        <span class="mf">0.90</span>        <span class="mf">0.90</span>        <span class="mf">0.90</span>        <span class="mf">0.90</span>
   <span class="mf">0.85</span>        <span class="mf">0.85</span>        <span class="mf">0.85</span>        <span class="mf">0.90</span>        <span class="mf">0.90</span>        <span class="mf">0.90</span>
   <span class="mf">0.85</span>        <span class="mf">0.85</span>        <span class="mf">0.85</span>        <span class="mf">0.85</span>        <span class="mf">0.90</span>        <span class="mf">0.90</span>
   <span class="mf">0.85</span>        <span class="mf">0.85</span>        <span class="mf">0.85</span>        <span class="mf">0.85</span>        <span class="mf">0.85</span>        <span class="mf">0.90</span>
   <span class="mf">0.85</span>        <span class="mf">0.85</span>        <span class="mf">0.85</span>        <span class="mf">0.85</span>        <span class="mf">0.85</span>        <span class="mf">0.85</span>

   <span class="mf">0.80</span>        <span class="mf">0.85</span>        <span class="mf">0.85</span>        <span class="mf">0.85</span>        <span class="mf">0.85</span>        <span class="mf">0.85</span>
   <span class="mf">0.80</span>        <span class="mf">0.80</span>        <span class="mf">0.85</span>        <span class="mf">0.85</span>        <span class="mf">0.85</span>        <span class="mf">0.85</span>
   <span class="mf">0.80</span>        <span class="mf">0.80</span>        <span class="mf">0.80</span>        <span class="mf">0.85</span>        <span class="mf">0.85</span>        <span class="mf">0.85</span>
   <span class="mf">0.80</span>        <span class="mf">0.80</span>        <span class="mf">0.80</span>        <span class="mf">0.80</span>        <span class="mf">0.85</span>        <span class="mf">0.85</span>
   <span class="mf">0.80</span>        <span class="mf">0.80</span>        <span class="mf">0.80</span>        <span class="mf">0.80</span>        <span class="mf">0.80</span>        <span class="mf">0.85</span>
   <span class="mf">0.80</span>        <span class="mf">0.80</span>        <span class="mf">0.80</span>        <span class="mf">0.80</span>        <span class="mf">0.80</span>        <span class="mf">0.80</span>
</pre></div>
</div>
<p>This will scan the percentage of individuals who should remain in quarantine
each day from <code class="docutils literal notranslate"><span class="pre">1.00</span></code> (100%) to <code class="docutils literal notranslate"><span class="pre">0.80</span></code> (80%). It does this in increments
of 0.05, starting from the longest period of isolation (7 days) and moving
that to the shortest period (less than 1 day).</p>
<p>There are a large number of jobs, and repeats are needed to properly
sample the outbreak. Here are job scripts to run this job on either a
PBS or Slurm cluster;</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1">#PBS -l walltime=12:00:00</span>
<span class="c1">#PBS -l select=4:ncpus=64:mem=64GB</span>
<span class="c1"># The above sets 4 nodes with 64 cores each</span>

<span class="nb">source</span> <span class="nv">$HOME</span>/envs/metawards/bin/activate

<span class="c1"># change into the directory from which this job was submitted</span>
<span class="nb">cd</span> <span class="nv">$PBS_O_WORKDIR</span>

metawards -d lurgy4 -D demographics.json -a ExtraSeedsLondon.dat <span class="se">\</span>
        --mixer mix_isolate --mover move_isolate --extractor extract_none <span class="se">\</span>
        --nsteps <span class="m">365</span> -i scan_remain.dat --repeats <span class="m">8</span> <span class="se">\</span>
        --nthreads <span class="m">16</span> --force-overwrite-output --no-spinner --theme simple
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1">#SBATCH --time=01:00:00</span>
<span class="c1">#SBATCH --ntasks=4</span>
<span class="c1">#SBATCH --cpus-per-task=64</span>
<span class="c1"># The above sets 4 nodes with 64 cores each</span>

<span class="nb">source</span> <span class="nv">$HOME</span>/envs/metawards/bin/activate

metawards -d lurgy4 -D demographics.json -a ExtraSeedsLondon.dat <span class="se">\</span>
        --mixer mix_isolate --mover move_isolate --extractor extract_none <span class="se">\</span>
        --nsteps <span class="m">365</span> -i scan_remain.dat --repeats <span class="m">8</span> <span class="se">\</span>
        --nthreads <span class="m">16</span> --force-overwrite-output --no-spinner --theme simple
</pre></div>
</div>
</div>
<div class="section" id="analysis">
<h2>Analysis<a class="headerlink" href="#analysis" title="Permalink to this headline">¶</a></h2>
<p>Once you have run the jobs, you can generate the animation of the overview
plots using;</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>metawards-plot -i output/results.csv.bz2
metawards-plot --animate output/overview*
</pre></div>
</div>
<p>You should get an animation that looks something like this;</p>
<img alt="Scanning compliance of remaining in quarantine" src="../../_images/tutorial_6_5_2.gif" />
</div>
<div class="section" id="reflections-on-results">
<h2>Reflections on results<a class="headerlink" href="#reflections-on-results" title="Permalink to this headline">¶</a></h2>
<p>Again, it is clear that self-isolation only works well if there is very
high compliance with remaining in quarantine for the full seven days.
As 5% of people break quarantine after 2-3 days, the size of the outbreak
grows from ~6 million to ~15 million. This grows to &gt;20 million if 10%
break quarantine.</p>
<p>All of these results suggest that, for the lurgy, that self-isolation and
quarantine are only effective strategies if;</p>
<ol class="arabic simple">
<li>they start as quickly as possible once an individual is infectious
(which may be difficult due to the early stage of the lurgy being largely
asymptomatic - track and trace systems would likely need to be used
and be extremely fast and effective),</li>
<li>are observed by the vast majority (&gt;90%) of infected individuals, and</li>
<li>&gt;95% of individuals remain in quarantine for the full seven days.</li>
</ol>
<p>As noted at the start of this tutorial, the lurgy is not a serious disease,
so would not warrant the level of social control needed to achieve these
three requirements (and, indeed, a population that does not perceive the
lurgy to be serious would be unlikely to comply to the level needed).</p>
<p>This should not be surprising given where each <em>model run</em> starts - just
five infected individuals in one ward. Any disease that is so contagious that
an infection in such a small group of individuals grows quickly into a
widespread outbreak will always be very difficult to control.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../index_part07.html" class="btn btn-neutral float-right" title="Part 7 - Different pathways for different demographics" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="04_compliance.html" class="btn btn-neutral float-left" title="Conditional Compliance" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
      <span class="lastupdated">
        Last updated on Jul 13, 2020.
      </span>

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>