

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Modelling vaccination &mdash; MetaWards Documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/custom.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Fading immunity" href="03_fading_immunity.html" />
    <link rel="prev" title="Creating intricate moves" href="01_move_ward.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html">
          

          
            
            <img src="../../_static/logo.jpg" class="logo" alt="Logo"/>
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
  <div id="version_box"></div>
</div>


          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../features.html">Features</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../install.html">Installation instructions</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../model_data.html">Model data</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../quickstart/index.html">Quick Start Guide</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Tutorial</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index_part01.html">Part 1 - Modelling outbreaks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index_part02.html">Part 2 - Refining the model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index_part03.html">Part 3 - Customising the outbreak</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index_part04.html">Part 4 - Customising the output</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index_part05.html">Part 5 - Modelling multiple demographics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index_part06.html">Part 6 - Moving between demographics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index_part07.html">Part 7 - Different pathways for different demographics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index_part08.html">Part 8 - Creating your own models / networks</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index_part09.html">Part 9 - Advanced Moves and Scenarios</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="01_move_ward.html">Creating intricate moves</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Modelling vaccination</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#vaccinating-using-go-ward">Vaccinating using go_ward</a></li>
<li class="toctree-l4"><a class="reference internal" href="#demand-driven-vaccination">Demand-driven vaccination</a></li>
<li class="toctree-l4"><a class="reference internal" href="#national-vaccination">National vaccination</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="03_fading_immunity.html">Fading immunity</a></li>
<li class="toctree-l3"><a class="reference internal" href="04_university.html">Modelling population movements</a></li>
<li class="toctree-l3"><a class="reference internal" href="05_holidays.html">Holidays and quarantine</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../fileformats/index.html">Input files and formats</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cluster_usage.html">Running on a cluster</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../support.html">Help and support</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devsupport.html">Developer Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../roadmap.html">Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../packaging.html">Packaging releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../development.html">Developer’s guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../snaglist.html">Snag list</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">Changelog</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../acknowledgements.html">Acknowledgements</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">MetaWards</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Tutorial</a> &raquo;</li>
        
          <li><a href="../index_part09.html">Part 9 - Advanced Moves and Scenarios</a> &raquo;</li>
        
      <li>Modelling vaccination</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
    
  </ul>

  
  <div class="rst-breadcrumbs-buttons" role="navigation" aria-label="breadcrumb navigation">
      
        <a href="03_fading_immunity.html" class="btn btn-neutral float-right" title="Fading immunity" accesskey="n">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
      
      
        <a href="01_move_ward.html" class="btn btn-neutral float-left" title="Creating intricate moves" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
      
  </div>
  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="modelling-vaccination">
<h1>Modelling vaccination<a class="headerlink" href="#modelling-vaccination" title="Permalink to this headline">¶</a></h1>
<p>Let’s now use <a class="reference internal" href="../../api/generated/metawards.movers.MoveGenerator.html#metawards.movers.MoveGenerator" title="metawards.movers.MoveGenerator"><code class="xref py py-class docutils literal notranslate"><span class="pre">MoveGenerator</span></code></a> and
<a class="reference internal" href="../../api/generated/metawards.movers.go_ward.html#metawards.movers.go_ward" title="metawards.movers.go_ward"><code class="xref py py-func docutils literal notranslate"><span class="pre">go_ward()</span></code></a> to model vaccination.</p>
<p>First, we will create a new version of the lurgy that includes
a vaccination stage. To do this in Python open ipython or
jupyter and type;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">metawards</span> <span class="kn">import</span> <span class="n">Disease</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lurgy</span> <span class="o">=</span> <span class="n">Disease</span><span class="p">(</span><span class="s2">&quot;lurgy5&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lurgy</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lurgy</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;I1&quot;</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lurgy</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;I2&quot;</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">too_ill_to_move</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lurgy</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;I3&quot;</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">too_ill_to_move</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lurgy</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;R&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lurgy</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;V&quot;</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">is_infected</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lurgy</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="s2">&quot;lurgy5.json&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">auto_bzip</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>or, in R/RStudio type;</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="nf">library</span><span class="p">(</span><span class="n">metawards</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">lurgy</span> <span class="o">&lt;-</span> <span class="n">metawards</span><span class="o">$</span><span class="nf">Disease</span><span class="p">(</span><span class="s">&quot;lurgy5&quot;</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">lurgy</span><span class="o">$</span><span class="nf">add</span><span class="p">(</span><span class="s">&quot;E&quot;</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="m">0.0</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="m">1.0</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">lurgy</span><span class="o">$</span><span class="nf">add</span><span class="p">(</span><span class="s">&quot;I1&quot;</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="m">0.4</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="m">0.2</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">lurgy</span><span class="o">$</span><span class="nf">add</span><span class="p">(</span><span class="s">&quot;I2&quot;</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="m">0.5</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="m">0.5</span><span class="p">,</span> <span class="n">too_ill_to_move</span><span class="o">=</span><span class="m">0.5</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">lurgy</span><span class="o">$</span><span class="nf">add</span><span class="p">(</span><span class="s">&quot;I3&quot;</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="m">0.5</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="m">0.8</span><span class="p">,</span> <span class="n">too_ill_to_move</span><span class="o">=</span><span class="m">0.8</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">lurgy</span><span class="o">$</span><span class="nf">add</span><span class="p">(</span><span class="s">&quot;R&quot;</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">lurgy</span><span class="o">$</span><span class="nf">add</span><span class="p">(</span><span class="s">&quot;V&quot;</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="m">0.0</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="m">0.0</span><span class="p">,</span> <span class="n">is_infected</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">lurgy</span><span class="o">$</span><span class="nf">to_json</span><span class="p">(</span><span class="s">&quot;lurgy5.json&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="m">2</span><span class="p">,</span> <span class="n">auto_bzip</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span>
</pre></div>
</div>
<p>or, simply copy the below into the file <code class="docutils literal notranslate"><span class="pre">lurgy5.json</span></code>;</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;lurgy5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;stage&quot;</span><span class="p">:</span>           <span class="p">[</span><span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="s2">&quot;I1&quot;</span><span class="p">,</span> <span class="s2">&quot;I2&quot;</span><span class="p">,</span> <span class="s2">&quot;I3&quot;</span><span class="p">,</span> <span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="s2">&quot;V&quot;</span><span class="p">],</span>
    <span class="s2">&quot;mapping&quot;</span><span class="p">:</span>         <span class="p">[</span><span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="s2">&quot;I&quot;</span><span class="p">,</span>  <span class="s2">&quot;I&quot;</span><span class="p">,</span>  <span class="s2">&quot;I&quot;</span><span class="p">,</span>  <span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="s2">&quot;V&quot;</span><span class="p">],</span>
    <span class="s2">&quot;beta&quot;</span><span class="p">:</span>            <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span>  <span class="mf">0.5</span><span class="p">,</span>  <span class="mf">0.5</span><span class="p">,</span>  <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
    <span class="s2">&quot;progress&quot;</span><span class="p">:</span>        <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span>  <span class="mf">0.5</span><span class="p">,</span>  <span class="mf">0.8</span><span class="p">,</span>  <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
    <span class="s2">&quot;too_ill_to_move&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>  <span class="mf">0.5</span><span class="p">,</span>  <span class="mf">0.8</span><span class="p">,</span>  <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
    <span class="s2">&quot;contrib_foi&quot;</span><span class="p">:</span>     <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>  <span class="mf">1.0</span><span class="p">,</span>  <span class="mf">1.0</span><span class="p">,</span>  <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
    <span class="s2">&quot;is_infected&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">true</span><span class="p">,</span> <span class="n">true</span><span class="p">,</span> <span class="n">true</span><span class="p">,</span> <span class="n">true</span><span class="p">,</span> <span class="n">false</span><span class="p">,</span> <span class="n">false</span><span class="p">],</span>
    <span class="s2">&quot;start_symptom&quot;</span><span class="p">:</span> <span class="mi">2</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This has added an extra stage, called V, which is used to hold
vaccinated individuals. Because vaccinated individuals are
not infected, we have to set <code class="docutils literal notranslate"><span class="pre">is_infected</span></code> to <code class="docutils literal notranslate"><span class="pre">false</span></code> for
this stage (note how this is set automatically for the R stage).</p>
<p>Also, once vaccinated, individuals will remain in the V stage. Thus
<code class="docutils literal notranslate"><span class="pre">progress</span></code> for this stage is set to <code class="docutils literal notranslate"><span class="pre">0.0</span></code>, just like it is
automatically set for the R stage.</p>
<p>We can run a quick test of this model using;</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">metawards</span> <span class="o">-</span><span class="n">d</span> <span class="n">lurgy5</span><span class="o">.</span><span class="n">json</span> <span class="o">-</span><span class="n">m</span> <span class="n">single</span> <span class="o">-</span><span class="n">a</span> <span class="mi">5</span>
</pre></div>
</div>
<p>This uses the single-ward model and infects 5 individuals on day 1 with
the disease described in <code class="docutils literal notranslate"><span class="pre">lurgy5.json</span></code>.</p>
<p>You should see that the outbreak progresses as before, with many of the
1000-strong population of the ward infected, and, currently, no-one
vaccinated.</p>
<div class="section" id="vaccinating-using-go-ward">
<h2>Vaccinating using go_ward<a class="headerlink" href="#vaccinating-using-go-ward" title="Permalink to this headline">¶</a></h2>
<p>We can model vaccination by writing a mover that uses
<a class="reference internal" href="../../api/generated/metawards.movers.go_ward.html#metawards.movers.go_ward" title="metawards.movers.go_ward"><code class="xref py py-class docutils literal notranslate"><span class="pre">go_ward</span></code></a> to move up to 50 individuals per
day from S to V (e.g. representing a vaccination capacity of
50 vaccinations per day).</p>
<p>Do this by creating a file called <code class="docutils literal notranslate"><span class="pre">move_vaccinate.py</span></code> and copying
in the below;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">metawards.movers</span> <span class="kn">import</span> <span class="n">MoveGenerator</span><span class="p">,</span> <span class="n">go_ward</span>


<span class="k">def</span> <span class="nf">move_vaccinate</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">capacity</span> <span class="o">=</span> <span class="mi">50</span>  <span class="c1"># number of vaccinations per day</span>

    <span class="k">def</span> <span class="nf">go_vaccinate</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">gen</span> <span class="o">=</span> <span class="n">MoveGenerator</span><span class="p">(</span><span class="n">from_stage</span><span class="o">=</span><span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="n">to_stage</span><span class="o">=</span><span class="s2">&quot;V&quot;</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="n">capacity</span><span class="p">)</span>
        <span class="n">go_ward</span><span class="p">(</span><span class="n">generator</span><span class="o">=</span><span class="n">gen</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">go_vaccinate</span><span class="p">]</span>
</pre></div>
</div>
<p>Run the model using;</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>metawards -d lurgy5.json -m single -a <span class="m">5</span> --mover move_vaccinate.py
</pre></div>
</div>
<p>You should see that the number of vaccinated individuals climbs by 50 each
day. This reduces the number of susceptibles, meaning that the infection
is dampened before it can get going.</p>
</div>
<div class="section" id="demand-driven-vaccination">
<h2>Demand-driven vaccination<a class="headerlink" href="#demand-driven-vaccination" title="Permalink to this headline">¶</a></h2>
<p>This model started vaccination on the first day of the outbreak. We
can instead trigger vaccination based on a threshold of infections,
e.g. because maybe the vaccine has a limited supply. Edit
<code class="docutils literal notranslate"><span class="pre">move_vaccinate.py</span></code> to add a trigger where vaccination starts
only when the number of infections grows above 100, e.g.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">metawards.movers</span> <span class="kn">import</span> <span class="n">MoveGenerator</span><span class="p">,</span> <span class="n">go_ward</span>
<span class="kn">from</span> <span class="nn">metawards.utils</span> <span class="kn">import</span> <span class="n">Console</span>


<span class="k">def</span> <span class="nf">move_vaccinate</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">capacity</span> <span class="o">=</span> <span class="mi">50</span>  <span class="c1"># number of vaccinations per day</span>
    <span class="n">trigger</span> <span class="o">=</span> <span class="mi">100</span>  <span class="c1"># number of infections to trigger vaccination</span>

    <span class="k">def</span> <span class="nf">go_vaccinate</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">population</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">params</span>

        <span class="c1"># Are we vaccinating? If this has not been set then we are not</span>
        <span class="n">is_vaccinating</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">user_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;is_vaccinating&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_vaccinating</span> <span class="ow">and</span> <span class="n">population</span><span class="o">.</span><span class="n">total</span> <span class="o">&gt;=</span> <span class="n">trigger</span><span class="p">:</span>
            <span class="c1"># trigger vaccination</span>
            <span class="n">params</span><span class="o">.</span><span class="n">user_params</span><span class="p">[</span><span class="s2">&quot;is_vaccinating&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">is_vaccinating</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">Console</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting vaccination&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">is_vaccinating</span><span class="p">:</span>
            <span class="n">gen</span> <span class="o">=</span> <span class="n">MoveGenerator</span><span class="p">(</span><span class="n">from_stage</span><span class="o">=</span><span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="n">to_stage</span><span class="o">=</span><span class="s2">&quot;V&quot;</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="n">capacity</span><span class="p">)</span>
            <span class="n">go_ward</span><span class="p">(</span><span class="n">generator</span><span class="o">=</span><span class="n">gen</span><span class="p">,</span> <span class="n">network</span><span class="o">=</span><span class="n">network</span><span class="p">,</span>
                    <span class="n">population</span><span class="o">=</span><span class="n">population</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">go_vaccinate</span><span class="p">]</span>
</pre></div>
</div>
<p>Run the model using;</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>metawards -d lurgy5.json -m single -a <span class="m">5</span> --mover move_vaccinate.py
</pre></div>
</div>
<p>You should see now in the output that vaccination starts when the number
of infections rises about 100, which for me happened on day 17.
Vaccination of the remaining susceptibles completed by day 27, with
the outbreak ending with 528 vaccinated individuals and 472 who
contracted the lurgy and recovered.</p>
</div>
<div class="section" id="national-vaccination">
<h2>National vaccination<a class="headerlink" href="#national-vaccination" title="Permalink to this headline">¶</a></h2>
<p>We can extend the model to vaccinate on a per-ward basis if the number
of infections climbs above a threshold in an individual ward. To do this,
modify <code class="docutils literal notranslate"><span class="pre">move_vaccinate.py</span></code> to read;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">metawards</span> <span class="kn">import</span> <span class="n">WardID</span>
<span class="kn">from</span> <span class="nn">metawards.movers</span> <span class="kn">import</span> <span class="n">MoveGenerator</span><span class="p">,</span> <span class="n">go_ward</span>
<span class="kn">from</span> <span class="nn">metawards.utils</span> <span class="kn">import</span> <span class="n">Console</span>


<span class="k">def</span> <span class="nf">move_vaccinate</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">capacity</span> <span class="o">=</span> <span class="mi">50</span>  <span class="c1"># number of vaccinations per day</span>
    <span class="n">trigger</span> <span class="o">=</span> <span class="mi">20</span>  <span class="c1"># number of infections to trigger vaccination</span>
    <span class="n">stop_trigger</span> <span class="o">=</span> <span class="mi">5</span> <span class="c1"># number of infections to stop vaccination</span>

    <span class="k">def</span> <span class="nf">go_vaccinate</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">workspace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># create ward-local is_vaccinating parameters, that defaults to 0.0</span>
        <span class="n">is_vaccinating</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">get_custom</span><span class="p">(</span><span class="s2">&quot;is_vaccinating&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>

        <span class="n">vaccinate</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">I_in_wards</span> <span class="o">=</span> <span class="n">workspace</span><span class="o">.</span><span class="n">I_in_wards</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">network</span><span class="o">.</span><span class="n">nnodes</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_vaccinating</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">I_in_wards</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">trigger</span><span class="p">:</span>
                    <span class="n">is_vaccinating</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>

            <span class="k">if</span> <span class="n">is_vaccinating</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">I_in_wards</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">stop_trigger</span><span class="p">:</span>
                    <span class="n">is_vaccinating</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">vaccinate</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">WardID</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">all_commute</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
                    <span class="n">vaccinate</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">WardID</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

        <span class="n">nv</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">is_vaccinating</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">nv</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Vaccinating in wards: number = </span><span class="si">{</span><span class="n">nv</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">gen</span> <span class="o">=</span> <span class="n">MoveGenerator</span><span class="p">(</span><span class="n">from_ward</span><span class="o">=</span><span class="n">vaccinate</span><span class="p">,</span>
                                <span class="n">from_stage</span><span class="o">=</span><span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="n">to_stage</span><span class="o">=</span><span class="s2">&quot;V&quot;</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="n">capacity</span><span class="p">)</span>
            <span class="n">go_ward</span><span class="p">(</span><span class="n">generator</span><span class="o">=</span><span class="n">gen</span><span class="p">,</span> <span class="n">network</span><span class="o">=</span><span class="n">network</span><span class="p">,</span>
                    <span class="n">workspace</span><span class="o">=</span><span class="n">workspace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">go_vaccinate</span><span class="p">]</span>
</pre></div>
</div>
<p>You can run this model using;</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>metawards -d lurgy5.json -m 2011Data --mover move_vaccinate.py -a ExtraSeedsLondon.dat
</pre></div>
</div>
<p>In this case, vaccination starts in a ward if the number of infections
grows to 50 or above. Then, there is capacity for 20 vaccinations per day
per ward and per ward-link. If the number of infections in the ward drops
below 5 then vaccination is stopped.</p>
<p>For my run, I see that all wards enter the vaccination program, with
eventually ~44 M vaccinations and ~10 M infections. The progress
plot produced via <code class="docutils literal notranslate"><span class="pre">metawards-plot</span></code> is shown below;</p>
<img alt="Demographic trajectories for the ward-local vaccinations" src="../../_images/tutorial_9_2.jpg" />
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="03_fading_immunity.html" class="btn btn-neutral float-right" title="Fading immunity" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="01_move_ward.html" class="btn btn-neutral float-left" title="Creating intricate moves" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
      <span class="lastupdated">
        Last updated on Feb 09, 2021.
      </span>

    </p>
  </div> 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>