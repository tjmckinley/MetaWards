

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Fading immunity &mdash; MetaWards Documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script src="../../_static/custom.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Modelling population movements" href="04_university.html" />
    <link rel="prev" title="Modelling vaccination" href="02_vaccinate.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html">
          

          
            
            <img src="../../_static/logo.jpg" class="logo" alt="Logo"/>
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
  <div id="version_box"></div>
</div>


          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../features.html">Features</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../install.html">Installation instructions</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../model_data.html">Model data</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../quickstart/index.html">Quick Start Guide</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Tutorial</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index_part01.html">Part 1 - Modelling outbreaks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index_part02.html">Part 2 - Refining the model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index_part03.html">Part 3 - Customising the outbreak</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index_part04.html">Part 4 - Customising the output</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index_part05.html">Part 5 - Modelling multiple demographics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index_part06.html">Part 6 - Moving between demographics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index_part07.html">Part 7 - Different pathways for different demographics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index_part08.html">Part 8 - Creating your own models / networks</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index_part09.html">Part 9 - Advanced Moves and Scenarios</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="01_move_ward.html">Creating intricate moves</a></li>
<li class="toctree-l3"><a class="reference internal" href="02_vaccinate.html">Modelling vaccination</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Fading immunity</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#slowing-progress">Slowing progress</a></li>
<li class="toctree-l4"><a class="reference internal" href="#time-since-recovery">Time since recovery</a></li>
<li class="toctree-l4"><a class="reference internal" href="#moving-from-r-to-s">Moving from R to S</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vaccination-and-boosters">Vaccination and boosters</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="04_university.html">Modelling population movements</a></li>
<li class="toctree-l3"><a class="reference internal" href="05_holidays.html">Holidays and quarantine</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../fileformats/index.html">Input files and formats</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cluster_usage.html">Running on a cluster</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../support.html">Help and support</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devsupport.html">Developer Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../roadmap.html">Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../packaging.html">Packaging releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../development.html">Developer’s guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../snaglist.html">Snag list</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">Changelog</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../acknowledgements.html">Acknowledgements</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">MetaWards</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Tutorial</a> &raquo;</li>
        
          <li><a href="../index_part09.html">Part 9 - Advanced Moves and Scenarios</a> &raquo;</li>
        
      <li>Fading immunity</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <div class="rst-breadcrumbs-buttons" role="navigation" aria-label="breadcrumb navigation">
      
        <a href="04_university.html" class="btn btn-neutral float-right" title="Modelling population movements" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="02_vaccinate.html" class="btn btn-neutral float-left" title="Modelling vaccination" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
  </div>
  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="fading-immunity">
<h1>Fading immunity<a class="headerlink" href="#fading-immunity" title="Permalink to this headline">¶</a></h1>
<p>Immunity to a disease is not always permanent. For some diseases, immunity
fades over time, meaning that an individual can be infected multiple times.</p>
<p>We can model this by using <a class="reference internal" href="../../api/generated/metawards.movers.go_ward.html#metawards.movers.go_ward" title="metawards.movers.go_ward"><code class="xref py py-func docutils literal notranslate"><span class="pre">go_ward()</span></code></a> to move
individuals from the R stage back to the S stage after a period of time.</p>
<div class="section" id="slowing-progress">
<h2>Slowing progress<a class="headerlink" href="#slowing-progress" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference internal" href="../../api/index_api_MetaWards.html#metawards.Disease.progress" title="metawards.Disease.progress"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Disease.progress</span></code></a> parameter controls
the rate at which an individual will move through a disease stage.
Advancement through the disease stages is controlled by
<a class="reference internal" href="../../api/generated/metawards.iterators.advance_recovery.html#metawards.iterators.advance_recovery" title="metawards.iterators.advance_recovery"><code class="xref py py-func docutils literal notranslate"><span class="pre">advance_recovery()</span></code></a>. This simply samples
the fraction, <a class="reference internal" href="../../api/index_api_MetaWards.html#metawards.Disease.progress" title="metawards.Disease.progress"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Disease.progress</span></code></a>,
from the number of individuals who are at that disease stage via
a random binomial distribution, and advances them to the next stage.</p>
<p>The key code that does this is summarised here;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># loop from the penultimate disease stage back to the first stage</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_INF_CLASSES</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="o">...</span>

    <span class="c1"># get the progress parameter for this disease stage</span>
    <span class="n">disease_progress</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">disease_params</span><span class="o">.</span><span class="n">progress</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="c1"># loop over all ward-links for this disease stage</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nlinks_plus_one</span><span class="p">):</span>
        <span class="c1"># get the number of workers in this link at this stage</span>
        <span class="n">inf_ij</span> <span class="o">=</span> <span class="n">infections_i</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">inf_ij</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># sample l workers from this stage based on disease_progress</span>
            <span class="n">l</span> <span class="o">=</span> <span class="n">_ran_binomial</span><span class="p">(</span><span class="n">rng</span><span class="p">,</span> <span class="n">disease_progress</span><span class="p">,</span> <span class="n">inf_ij</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">l</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># move l workers from this stage to the next stage</span>
                <span class="n">infections_i_plus_one</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">l</span>
                <span class="n">infections_i</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-=</span> <span class="n">l</span>

    <span class="c1"># loop over all nodes / wards for this disease stage</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nnodes_plus_one</span><span class="p">):</span>
        <span class="c1"># get the number of players in this ward at this stage</span>
        <span class="n">inf_ij</span> <span class="o">=</span> <span class="n">play_infections_i</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">inf_ij</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># sample l players from this stage based on disease_progress</span>
            <span class="n">l</span> <span class="o">=</span> <span class="n">_ran_binomial</span><span class="p">(</span><span class="n">rng</span><span class="p">,</span> <span class="n">disease_progress</span><span class="p">,</span> <span class="n">inf_ij</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">l</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># move l players from this stage to the next stage</span>
                <span class="n">play_infections_i_plus_one</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">l</span>
                <span class="n">play_infections_i</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-=</span> <span class="n">l</span>
</pre></div>
</div>
</div>
<div class="section" id="time-since-recovery">
<h2>Time since recovery<a class="headerlink" href="#time-since-recovery" title="Permalink to this headline">¶</a></h2>
<p>To measure time since recovery, we can add extra “post-recovery” stages.
Individuals will be set to move slowly through those “post-recovery”
stages, until, when a particular post-recovery stage is reached, a fraction
of individuals are deemed to have lost immunity to the disease, and
are moved back to the S stage.</p>
<p>To do this, we will create a new version of the lurgy with these extra
post-recovery stages, which we will call <code class="docutils literal notranslate"><span class="pre">R1</span></code> to <code class="docutils literal notranslate"><span class="pre">R10</span></code>. To do this
in Python, open ipython or jupyter and type;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">metawards</span> <span class="kn">import</span> <span class="n">Disease</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lurgy</span> <span class="o">=</span> <span class="n">Disease</span><span class="p">(</span><span class="s2">&quot;lurgy6&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lurgy</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lurgy</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;I1&quot;</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lurgy</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;I2&quot;</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">too_ill_to_move</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lurgy</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;I3&quot;</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">too_ill_to_move</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">R_progress</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lurgy</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="n">R_progress</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">):</span>
<span class="gp">... </span>   <span class="n">lurgy</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;R</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="n">R_progress</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lurgy</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="s2">&quot;lurgy6.json&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">auto_bzip</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>or, in R/RStudio you could type;</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="nf">library</span><span class="p">(</span><span class="n">metawards</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">lurgy</span> <span class="o">&lt;-</span> <span class="n">metawards</span><span class="o">$</span><span class="nf">Disease</span><span class="p">(</span><span class="s">&quot;lurgy6&quot;</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">lurgy</span><span class="o">$</span><span class="nf">add</span><span class="p">(</span><span class="s">&quot;E&quot;</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="m">0.0</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="m">1.0</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">lurgy</span><span class="o">$</span><span class="nf">add</span><span class="p">(</span><span class="s">&quot;I1&quot;</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="m">0.4</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="m">0.2</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">lurgy</span><span class="o">$</span><span class="nf">add</span><span class="p">(</span><span class="s">&quot;I2&quot;</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="m">0.5</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="m">0.5</span><span class="p">,</span> <span class="n">too_ill_to_move</span><span class="o">=</span><span class="m">0.5</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">lurgy</span><span class="o">$</span><span class="nf">add</span><span class="p">(</span><span class="s">&quot;I3&quot;</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="m">0.5</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="m">0.8</span><span class="p">,</span> <span class="n">too_ill_to_move</span><span class="o">=</span><span class="m">0.8</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">R_progress</span> <span class="o">&lt;-</span> <span class="m">0.5</span>
<span class="o">&gt;</span> <span class="n">lurgy</span><span class="o">$</span><span class="nf">add</span><span class="p">(</span><span class="s">&quot;R&quot;</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="n">R_progress</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="nf">for</span><span class="p">(</span><span class="n">i</span> <span class="n">in</span> <span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">stage</span> <span class="o">&lt;-</span> <span class="nf">sprintf</span><span class="p">(</span><span class="s">&quot;R%d&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
      <span class="n">lurgy</span><span class="o">$</span><span class="nf">add</span><span class="p">(</span><span class="n">stage</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="m">0.0</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="n">R_progress</span><span class="p">)</span>
  <span class="p">}</span>
<span class="o">&gt;</span> <span class="n">lurgy</span><span class="o">$</span><span class="nf">to_json</span><span class="p">(</span><span class="s">&quot;lurgy6.json&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="m">2</span><span class="p">,</span> <span class="n">auto_bzip</span><span class="o">=</span><span class="n">False</span><span class="p">)</span>
</pre></div>
</div>
<p>or simply copy the below into <code class="docutils literal notranslate"><span class="pre">lurgy6.json</span></code>;</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;lurgy6&quot;</span><span class="p">,</span>
  <span class="s2">&quot;stage&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="s2">&quot;I1&quot;</span><span class="p">,</span> <span class="s2">&quot;I2&quot;</span><span class="p">,</span> <span class="s2">&quot;I3&quot;</span><span class="p">,</span> <span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="s2">&quot;R1&quot;</span><span class="p">,</span> <span class="s2">&quot;R2&quot;</span><span class="p">,</span>
              <span class="s2">&quot;R3&quot;</span><span class="p">,</span> <span class="s2">&quot;R4&quot;</span><span class="p">,</span> <span class="s2">&quot;R5&quot;</span><span class="p">,</span> <span class="s2">&quot;R6&quot;</span><span class="p">,</span> <span class="s2">&quot;R7&quot;</span><span class="p">,</span> <span class="s2">&quot;R8&quot;</span><span class="p">,</span>
              <span class="s2">&quot;R9&quot;</span><span class="p">,</span> <span class="s2">&quot;R10&quot;</span><span class="p">],</span>
  <span class="s2">&quot;mapping&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="s2">&quot;R&quot;</span><span class="p">,</span>
              <span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="s2">&quot;R&quot;</span><span class="p">,</span>
              <span class="s2">&quot;R&quot;</span><span class="p">],</span>
  <span class="s2">&quot;beta&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
          <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
  <span class="s2">&quot;progress&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span>
              <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span>
              <span class="mf">0.5</span><span class="p">],</span>
  <span class="s2">&quot;too_ill_to_move&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
                      <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
                      <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
  <span class="s2">&quot;contrib_foi&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
                  <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
  <span class="s2">&quot;start_symptom&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
  <span class="s2">&quot;is_infected&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">true</span><span class="p">,</span> <span class="n">true</span><span class="p">,</span> <span class="n">true</span><span class="p">,</span> <span class="n">true</span><span class="p">,</span> <span class="n">false</span><span class="p">,</span> <span class="n">false</span><span class="p">,</span>
                  <span class="n">false</span><span class="p">,</span> <span class="n">false</span><span class="p">,</span> <span class="n">false</span><span class="p">,</span> <span class="n">false</span><span class="p">,</span> <span class="n">false</span><span class="p">,</span> <span class="n">false</span><span class="p">,</span>
                  <span class="n">false</span><span class="p">,</span> <span class="n">false</span><span class="p">,</span> <span class="n">false</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This creates 10 post-recovery stages, with a progress parameter for these
stages of 0.5. This means, at quickest, an individual would take
10 days to progress from R to R10, but on average, this will take much
longer (as 50% move from one stage to the next each day).</p>
</div>
<div class="section" id="moving-from-r-to-s">
<h2>Moving from R to S<a class="headerlink" href="#moving-from-r-to-s" title="Permalink to this headline">¶</a></h2>
<p>Next, we need to add a move function that will move a fraction of individuals
from R10 back to S, to represent that fraction losing immunity.</p>
<p>Create a mover called <code class="docutils literal notranslate"><span class="pre">move_immunity.py</span></code> and copy in the below;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">metawards.movers</span> <span class="kn">import</span> <span class="n">MoveGenerator</span><span class="p">,</span> <span class="n">go_ward</span><span class="p">,</span> <span class="n">MoveRecord</span>
<span class="kn">from</span> <span class="nn">metawards.utils</span> <span class="kn">import</span> <span class="n">Console</span>


<span class="k">def</span> <span class="nf">move_immunity</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">go_immunity</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">record</span> <span class="o">=</span> <span class="n">MoveRecord</span><span class="p">()</span>
        <span class="n">gen</span> <span class="o">=</span> <span class="n">MoveGenerator</span><span class="p">(</span><span class="n">from_stage</span><span class="o">=</span><span class="s2">&quot;R10&quot;</span><span class="p">,</span> <span class="n">to_stage</span><span class="o">=</span><span class="s2">&quot;S&quot;</span><span class="p">,</span>
                            <span class="n">fraction</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

        <span class="n">go_ward</span><span class="p">(</span><span class="n">generator</span><span class="o">=</span><span class="n">gen</span><span class="p">,</span> <span class="n">record</span><span class="o">=</span><span class="n">record</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">nlost</span> <span class="o">=</span> <span class="n">record</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">Console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">nlost</span><span class="si">}</span><span class="s2"> individual(s) lost immunity today&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">go_immunity</span><span class="p">]</span>
</pre></div>
</div>
<p>This will move 50% of R10 individuals back to S each day.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We have used <a class="reference internal" href="../../api/generated/metawards.movers.MoveRecord.html#metawards.movers.MoveRecord" title="metawards.movers.MoveRecord"><code class="xref py py-class docutils literal notranslate"><span class="pre">MoveRecord</span></code></a> to record the moves
performed by <a class="reference internal" href="../../api/generated/metawards.movers.go_ward.html#metawards.movers.go_ward" title="metawards.movers.go_ward"><code class="xref py py-func docutils literal notranslate"><span class="pre">go_ward()</span></code></a>. This keeps a complete
record of exactly how many individuals were moved, and the full
details of that move. In this case, there will only be a single
move (<code class="docutils literal notranslate"><span class="pre">record[0]</span></code>), and the number of individuals who were moved
is the last value in the record (<code class="docutils literal notranslate"><span class="pre">record[0][-1]</span></code>).</p>
</div>
<p>You can run the model using;</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>metawards -d lurgy6.json -m single -a <span class="m">5</span> --move move_immunity.py
</pre></div>
</div>
<p>(using the single-ward model, seeding with 5 initial infection).</p>
<p>You should see that the outbreak oscillates as individuals who have
lost immunity are re-infected. For example, the graph I get
(from <code class="docutils literal notranslate"><span class="pre">metawards-plot</span></code>) are shown below;</p>
<img alt="Outbreak trajectory when individuals can lose immunity" src="../../_images/tutorial_9_3_1.jpg" />
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is just an illustrative example. Individuals lose immunity in
this model far more quickly than would be expected for a real disease.
You could modify this example to use
<a class="reference internal" href="../part02/02_adjustable.html"><span class="doc">custom user variables</span></a> to
scan through different values of <code class="docutils literal notranslate"><span class="pre">progress</span></code> for each
of the post-recovery stages, to better model a more realistic disease.</p>
</div>
</div>
<div class="section" id="vaccination-and-boosters">
<h2>Vaccination and boosters<a class="headerlink" href="#vaccination-and-boosters" title="Permalink to this headline">¶</a></h2>
<p>You can apply the same method to model fading immunity after a vaccination.
This could be used to best plan how often booster doses should be deployed.</p>
<p>To do this, we will modify our lurgy to model to include vaccination
and post-vaccination stages. For example, in Python (in ipython/Jupyter);</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">metawards</span> <span class="kn">import</span> <span class="n">Disease</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lurgy</span> <span class="o">=</span> <span class="n">Disease</span><span class="p">(</span><span class="s2">&quot;lurgy7&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lurgy</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lurgy</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;I1&quot;</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lurgy</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;I2&quot;</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">too_ill_to_move</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lurgy</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;I3&quot;</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">too_ill_to_move</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">R_progress</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">V_progress</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lurgy</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="n">R_progress</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
<span class="gp">... </span>   <span class="n">lurgy</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;R</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="n">R_progress</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lurgy</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;R10&quot;</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lurgy</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;V&quot;</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="n">V_progress</span><span class="p">,</span> <span class="n">is_infected</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">lurgy</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;V</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="n">V_progress</span><span class="p">,</span>
<span class="gp">... </span>              <span class="n">is_infected</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lurgy</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="s2">&quot;lurgy7.json&quot;</span><span class="p">,</span> <span class="n">auto_bzip</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="nf">library</span><span class="p">(</span><span class="n">metawards</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">lurgy</span> <span class="o">&lt;-</span> <span class="n">metawards</span><span class="o">$</span><span class="nf">Disease</span><span class="p">(</span><span class="s">&quot;lurgy7&quot;</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">lurgy</span><span class="o">$</span><span class="nf">add</span><span class="p">(</span><span class="s">&quot;E&quot;</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="m">0.0</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="m">1.0</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">lurgy</span><span class="o">$</span><span class="nf">add</span><span class="p">(</span><span class="s">&quot;I1&quot;</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="m">0.4</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="m">0.2</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">lurgy</span><span class="o">$</span><span class="nf">add</span><span class="p">(</span><span class="s">&quot;I2&quot;</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="m">0.5</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="m">0.5</span><span class="p">,</span> <span class="n">too_ill_to_move</span><span class="o">=</span><span class="m">0.5</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">lurgy</span><span class="o">$</span><span class="nf">add</span><span class="p">(</span><span class="s">&quot;I3&quot;</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="m">0.5</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="m">0.8</span><span class="p">,</span> <span class="n">too_ill_to_move</span><span class="o">=</span><span class="m">0.8</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">R_progress</span> <span class="o">&lt;-</span> <span class="m">0.5</span>
<span class="o">&gt;</span> <span class="n">V_progress</span> <span class="o">&lt;-</span> <span class="m">0.5</span>
<span class="o">&gt;</span> <span class="n">lurgy</span><span class="o">$</span><span class="nf">add</span><span class="p">(</span><span class="s">&quot;R&quot;</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="n">R_progress</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="nf">for</span><span class="p">(</span><span class="n">i</span> <span class="n">in</span> <span class="m">1</span><span class="o">:</span><span class="m">9</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">stage</span> <span class="o">&lt;-</span> <span class="nf">sprintf</span><span class="p">(</span><span class="s">&quot;R%d&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
      <span class="n">lurgy</span><span class="o">$</span><span class="nf">add</span><span class="p">(</span><span class="n">stage</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="m">0.0</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="n">R_progress</span><span class="p">)</span>
  <span class="p">}</span>
<span class="o">&gt;</span> <span class="nf">lurgy.add</span><span class="p">(</span><span class="s">&quot;R10&quot;</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="m">0.0</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="m">0.0</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="nf">lurgy.add</span><span class="p">(</span><span class="s">&quot;V&quot;</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="n">V_progress</span><span class="p">,</span> <span class="n">is_infected</span><span class="o">=</span><span class="n">False</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="nf">for</span><span class="p">(</span><span class="n">i</span> <span class="n">in</span> <span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">stage</span> <span class="o">&lt;-</span> <span class="nf">sprintf</span><span class="p">(</span><span class="s">&quot;V%d&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
      <span class="n">lurgy</span><span class="o">$</span><span class="nf">add</span><span class="p">(</span><span class="n">stage</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="m">0.0</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="n">V_progress</span><span class="p">)</span>
  <span class="p">}</span>
<span class="o">&gt;</span> <span class="nf">lurgy.to_json</span><span class="p">(</span><span class="s">&quot;lurgy7.json&quot;</span><span class="p">,</span> <span class="n">auto_bzip</span><span class="o">=</span><span class="n">False</span><span class="p">)</span>
</pre></div>
</div>
<p>or copy the below into <code class="docutils literal notranslate"><span class="pre">lurgy7.json</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;lurgy7&quot;</span><span class="p">,</span>
  <span class="s2">&quot;stage&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="s2">&quot;I1&quot;</span><span class="p">,</span> <span class="s2">&quot;I2&quot;</span><span class="p">,</span> <span class="s2">&quot;I3&quot;</span><span class="p">,</span> <span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="s2">&quot;R1&quot;</span><span class="p">,</span>
            <span class="s2">&quot;R2&quot;</span><span class="p">,</span> <span class="s2">&quot;R3&quot;</span><span class="p">,</span> <span class="s2">&quot;R4&quot;</span><span class="p">,</span> <span class="s2">&quot;R5&quot;</span><span class="p">,</span> <span class="s2">&quot;R6&quot;</span><span class="p">,</span> <span class="s2">&quot;R7&quot;</span><span class="p">,</span>
            <span class="s2">&quot;R8&quot;</span><span class="p">,</span> <span class="s2">&quot;R9&quot;</span><span class="p">,</span> <span class="s2">&quot;R10&quot;</span><span class="p">,</span> <span class="s2">&quot;V&quot;</span><span class="p">,</span> <span class="s2">&quot;V1&quot;</span><span class="p">,</span> <span class="s2">&quot;V2&quot;</span><span class="p">,</span>
            <span class="s2">&quot;V3&quot;</span><span class="p">,</span> <span class="s2">&quot;V4&quot;</span><span class="p">,</span> <span class="s2">&quot;V5&quot;</span><span class="p">,</span> <span class="s2">&quot;V6&quot;</span><span class="p">,</span> <span class="s2">&quot;V7&quot;</span><span class="p">,</span> <span class="s2">&quot;V8&quot;</span><span class="p">,</span>
            <span class="s2">&quot;V9&quot;</span><span class="p">,</span> <span class="s2">&quot;V10&quot;</span><span class="p">],</span>
  <span class="s2">&quot;mapping&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="s2">&quot;R&quot;</span><span class="p">,</span>
              <span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="s2">&quot;R&quot;</span><span class="p">,</span>
              <span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="s2">&quot;V&quot;</span><span class="p">,</span> <span class="s2">&quot;V&quot;</span><span class="p">,</span> <span class="s2">&quot;V&quot;</span><span class="p">,</span> <span class="s2">&quot;V&quot;</span><span class="p">,</span> <span class="s2">&quot;V&quot;</span><span class="p">,</span> <span class="s2">&quot;V&quot;</span><span class="p">,</span>
              <span class="s2">&quot;V&quot;</span><span class="p">,</span> <span class="s2">&quot;V&quot;</span><span class="p">,</span> <span class="s2">&quot;V&quot;</span><span class="p">,</span> <span class="s2">&quot;V&quot;</span><span class="p">,</span> <span class="s2">&quot;V&quot;</span><span class="p">],</span>
  <span class="s2">&quot;beta&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
           <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
           <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
           <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
  <span class="s2">&quot;progress&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span>
               <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span>
               <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span>
               <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span>
               <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>
  <span class="s2">&quot;too_ill_to_move&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
                      <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
                      <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
                      <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
                      <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
  <span class="s2">&quot;contrib_foi&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
                  <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
                  <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
                  <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
  <span class="s2">&quot;start_symptom&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
  <span class="s2">&quot;is_infected&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">true</span><span class="p">,</span> <span class="n">true</span><span class="p">,</span> <span class="n">true</span><span class="p">,</span> <span class="n">true</span><span class="p">,</span> <span class="n">false</span><span class="p">,</span> <span class="n">false</span><span class="p">,</span>
                  <span class="n">false</span><span class="p">,</span> <span class="n">false</span><span class="p">,</span> <span class="n">false</span><span class="p">,</span> <span class="n">false</span><span class="p">,</span> <span class="n">false</span><span class="p">,</span> <span class="n">false</span><span class="p">,</span>
                  <span class="n">false</span><span class="p">,</span> <span class="n">false</span><span class="p">,</span> <span class="n">false</span><span class="p">,</span> <span class="n">false</span><span class="p">,</span> <span class="n">false</span><span class="p">,</span> <span class="n">false</span><span class="p">,</span>
                  <span class="n">false</span><span class="p">,</span> <span class="n">false</span><span class="p">,</span> <span class="n">false</span><span class="p">,</span> <span class="n">false</span><span class="p">,</span> <span class="n">false</span><span class="p">,</span> <span class="n">false</span><span class="p">,</span>
                  <span class="n">false</span><span class="p">,</span> <span class="n">false</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note how <code class="docutils literal notranslate"><span class="pre">progress</span></code> for the <code class="docutils literal notranslate"><span class="pre">R10</span></code> stage is set to 0 to prevent
<code class="docutils literal notranslate"><span class="pre">R10</span></code> automatic progression from <code class="docutils literal notranslate"><span class="pre">R10</span></code> to <code class="docutils literal notranslate"><span class="pre">V</span></code>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note also that we have to manually set <code class="docutils literal notranslate"><span class="pre">is_infected</span></code> to false for
the V stages. This is set automatically to false only for R stages.</p>
</div>
<p>Next, modify <code class="docutils literal notranslate"><span class="pre">move_immunity.py</span></code> to read;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">metawards.movers</span> <span class="kn">import</span> <span class="n">MoveGenerator</span><span class="p">,</span> <span class="n">go_ward</span><span class="p">,</span> <span class="n">MoveRecord</span>
<span class="kn">from</span> <span class="nn">metawards.utils</span> <span class="kn">import</span> <span class="n">Console</span>


<span class="k">def</span> <span class="nf">move_immunity</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">go_vaccinate</span><span class="p">(</span><span class="n">population</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">population</span><span class="o">.</span><span class="n">day</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">gen</span> <span class="o">=</span> <span class="n">MoveGenerator</span><span class="p">(</span><span class="n">from_stage</span><span class="o">=</span><span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="n">to_stage</span><span class="o">=</span><span class="s2">&quot;V&quot;</span><span class="p">,</span>
                                <span class="n">number</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
            <span class="n">go_ward</span><span class="p">(</span><span class="n">generator</span><span class="o">=</span><span class="n">gen</span><span class="p">,</span> <span class="n">population</span><span class="o">=</span><span class="n">population</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">go_immunity</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">record</span> <span class="o">=</span> <span class="n">MoveRecord</span><span class="p">()</span>
        <span class="n">gen</span> <span class="o">=</span> <span class="n">MoveGenerator</span><span class="p">(</span><span class="n">from_stage</span><span class="o">=</span><span class="s2">&quot;R10&quot;</span><span class="p">,</span> <span class="n">to_stage</span><span class="o">=</span><span class="s2">&quot;S&quot;</span><span class="p">,</span>
                            <span class="n">fraction</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

        <span class="n">go_ward</span><span class="p">(</span><span class="n">generator</span><span class="o">=</span><span class="n">gen</span><span class="p">,</span> <span class="n">record</span><span class="o">=</span><span class="n">record</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">Console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">record</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> individual(s) lost immunity today&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">go_booster</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">gen</span> <span class="o">=</span> <span class="n">MoveGenerator</span><span class="p">(</span><span class="n">from_stage</span><span class="o">=</span><span class="s2">&quot;V10&quot;</span><span class="p">,</span> <span class="n">to_stage</span><span class="o">=</span><span class="s2">&quot;V&quot;</span><span class="p">,</span>
                            <span class="n">fraction</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="n">go_ward</span><span class="p">(</span><span class="n">generator</span><span class="o">=</span><span class="n">gen</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">record</span> <span class="o">=</span> <span class="n">MoveRecord</span><span class="p">()</span>
        <span class="n">gen</span> <span class="o">=</span> <span class="n">MoveGenerator</span><span class="p">(</span><span class="n">from_stage</span><span class="o">=</span><span class="s2">&quot;V10&quot;</span><span class="p">,</span> <span class="n">to_stage</span><span class="o">=</span><span class="s2">&quot;S&quot;</span><span class="p">)</span>
        <span class="n">go_ward</span><span class="p">(</span><span class="n">generator</span><span class="o">=</span><span class="n">gen</span><span class="p">,</span> <span class="n">record</span><span class="o">=</span><span class="n">record</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">Console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">record</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> individual(s) didn&#39;t get their booster&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">go_vaccinate</span><span class="p">,</span> <span class="n">go_booster</span><span class="p">,</span> <span class="n">go_immunity</span><span class="p">]</span>
</pre></div>
</div>
<p>Here, we’ve added a <code class="docutils literal notranslate"><span class="pre">go_vaccinate</span></code> function that, for the first
10 days of the outbreak, moves up to 100 individuals
per day from S to V. This will, in effect, vaccinate all of the
population of 1000 individuals who are not infected.</p>
<p>Next, we’ve added a <code class="docutils literal notranslate"><span class="pre">go_booster</span></code> function that samples 20% of the <code class="docutils literal notranslate"><span class="pre">V10</span></code>
stage to give them a booster vaccine that returns them to <code class="docutils literal notranslate"><span class="pre">V</span></code>. The
remaining individuals in <code class="docutils literal notranslate"><span class="pre">V10</span></code> miss their booster dose, and are
returned to <code class="docutils literal notranslate"><span class="pre">S</span></code>.</p>
<p>You can run the model using;</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>metawards -d lurgy7.json -m single -a <span class="m">5</span> --move move_immunity.py
</pre></div>
</div>
<p>You should see that the infection nearly dies out, as nearly everyone
is vaccinated. However, a small number of lingering infections spark
a second outbreak amongst individuals who miss their booster shot,
leading then to a cycle of infection and losing immunity, e.g.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>─────────────────────────────────────────────── Day 9 ────────────────────────────────────────────────
S: 89  E: 0  I: 6  V: 900  R: 5  IW: 0  POPULATION: 1000
Number of infections: 6

─────────────────────────────────────────────── Day 10 ───────────────────────────────────────────────
S: 0  E: 0  I: 6  V: 989  R: 5  IW: 0  POPULATION: 1000
Number of infections: 6

─────────────────────────────────────────────── Day 11 ───────────────────────────────────────────────
S: 0  E: 0  I: 6  V: 989  R: 5  IW: 0  POPULATION: 1000
Number of infections: 6

─────────────────────────────────────────────── Day 12 ───────────────────────────────────────────────
1 individual(s) didn&#39;t get their booster
S: 1  E: 0  I: 6  V: 988  R: 5  IW: 0  POPULATION: 1000
Number of infections: 6

...

─────────────────────────────────────────────── Day 23 ───────────────────────────────────────────────
54 individual(s) didn&#39;t get their booster
S: 309  E: 0  I: 2  V: 680  R: 9  IW: 0  POPULATION: 1000
Number of infections: 2

─────────────────────────────────────────────── Day 24 ───────────────────────────────────────────────
72 individual(s) didn&#39;t get their booster
2 individual(s) lost immunity today
S: 383  E: 0  I: 2  V: 608  R: 7  IW: 0  POPULATION: 1000
Number of infections: 2

─────────────────────────────────────────────── Day 25 ───────────────────────────────────────────────
60 individual(s) didn&#39;t get their booster
S: 443  E: 0  I: 2  V: 548  R: 7  IW: 0  POPULATION: 1000
Number of infections: 2

─────────────────────────────────────────────── Day 26 ───────────────────────────────────────────────
64 individual(s) didn&#39;t get their booster
1 individual(s) lost immunity today
S: 507  E: 1  I: 2  V: 484  R: 6  IW: 1  POPULATION: 1000
Number of infections: 3

─────────────────────────────────────────────── Day 27 ───────────────────────────────────────────────
49 individual(s) didn&#39;t get their booster
1 individual(s) lost immunity today
S: 557  E: 0  I: 3  V: 435  R: 5  IW: 0  POPULATION: 1000
Number of infections: 3

─────────────────────────────────────────────── Day 28 ───────────────────────────────────────────────
44 individual(s) didn&#39;t get their booster
S: 599  E: 2  I: 3  V: 391  R: 5  IW: 1  POPULATION: 1000
Number of infections: 5

...

─────────────────────────────────────────────── Day 40 ───────────────────────────────────────────────
8 individual(s) didn&#39;t get their booster
S: 776  E: 7  I: 39  V: 162  R: 16  IW: 1  POPULATION: 1000
Number of infections: 46

─────────────────────────────────────────────── Day 41 ───────────────────────────────────────────────
8 individual(s) didn&#39;t get their booster
S: 776  E: 8  I: 45  V: 154  R: 17  IW: 1  POPULATION: 1000
Number of infections: 53

...

────────────────────────────────────────────── Day 103 ───────────────────────────────────────────────
11 individual(s) lost immunity today
S: 289  E: 32  I: 329  V: 2  R: 348  IW: 1  POPULATION: 1000
Number of infections: 361

────────────────────────────────────────────── Day 104 ───────────────────────────────────────────────
12 individual(s) lost immunity today
S: 258  E: 43  I: 319  V: 2  R: 378  IW: 1  POPULATION: 1000
Number of infections: 362

────────────────────────────────────────────── Day 105 ───────────────────────────────────────────────
1 individual(s) didn&#39;t get their booster
11 individual(s) lost immunity today
S: 233  E: 37  I: 325  V: 1  R: 404  IW: 1  POPULATION: 1000
Number of infections: 362
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Again, this is just an illustrative example. Immunity from vaccination would
be expected to last for much longer than a couple of weeks.
You could use adjustable variables (and custom user-adjustable
variables) to scan through the progress along the post-vaccination
stages, the numbers vaccinated each day, and different percentages
of individuals who take a booster, to better model a real situation.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We have used <a class="reference internal" href="../../api/index_api_MetaWards.html#metawards.Disease.progress" title="metawards.Disease.progress"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Disease.progress</span></code></a>
to slow movement along the post-recovery and post-vaccinated stages.
An alternative method would be to write a custom iterator to
replace <a class="reference internal" href="../../api/generated/metawards.iterators.advance_recovery.html#metawards.iterators.advance_recovery" title="metawards.iterators.advance_recovery"><code class="xref py py-func docutils literal notranslate"><span class="pre">advance_recovery()</span></code></a>. This could
slow down movement programmatically, e.g. by only testing for
advancement along the <code class="docutils literal notranslate"><span class="pre">R</span></code> and <code class="docutils literal notranslate"><span class="pre">V</span></code> stages every 10 days, as
opposed to every day. We’ve designed <code class="docutils literal notranslate"><span class="pre">metawards</span></code> to be very
flexible, so that you have many choices for how you want to
model different scenarios.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="04_university.html" class="btn btn-neutral float-right" title="Modelling population movements" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="02_vaccinate.html" class="btn btn-neutral float-left" title="Modelling vaccination" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
      <span class="lastupdated">
        Last updated on Nov 18, 2020.
      </span>

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>