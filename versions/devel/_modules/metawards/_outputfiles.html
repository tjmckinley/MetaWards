

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>metawards._outputfiles &mdash; MetaWards Documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/custom.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html">
          

          
            
            <img src="../../_static/logo.jpg" class="logo" alt="Logo"/>
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
  <div id="version_box"></div>
</div>


          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../features.html">Features</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../install.html">Installation instructions</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../model_data.html">Model data</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../quickstart/index.html">Quick Start Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/index.html">Tutorial</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../fileformats/index.html">Input files and formats</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cluster_usage.html">Running on a cluster</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../support.html">Help and support</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devsupport.html">Developer Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../roadmap.html">Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../packaging.html">Packaging releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../development.html">Developerâ€™s guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../snaglist.html">Snag list</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">Changelog</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../acknowledgements.html">Acknowledgements</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">MetaWards</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../metawards.html">metawards</a> &raquo;</li>
        
      <li>metawards._outputfiles</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for metawards._outputfiles</h1><div class="highlight"><pre>
<span></span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span> <span class="k">as</span> <span class="n">_Path</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;OutputFiles&quot;</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">_get_bool</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Simple function to make sure that flags that are supposed</span>
<span class="sd">       to be true/false are actually stored as bools</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">arg</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>


<span class="k">def</span> <span class="nf">_is_empty</span><span class="p">(</span><span class="n">outdir</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Simple function that checks whether or not the passed directory</span>
<span class="sd">       is empty</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">os</span>

    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">outdir</span><span class="p">):</span>
        <span class="c1"># this is a file, so it definitely is not &#39;empty&#39;</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">outdir</span><span class="p">):</span>
        <span class="c1"># the directory is empty if it contains no hidden files</span>
        <span class="c1"># or other directories - sorry to wipe out dotfiles...!</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">outdir</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>


<span class="k">def</span> <span class="nf">_rmdir</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function modified from one copied from &#39;mitch&#39; on stackoverflow</span>
<span class="sd">       https://stackoverflow.com/questions/13118029/deleting-folders-in-python-recursively</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">directory</span> <span class="o">=</span> <span class="n">_Path</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>

    <span class="c1"># first, check for removing important directories such as $HOME or root</span>
    <span class="k">if</span> <span class="n">directory</span> <span class="o">==</span> <span class="n">_Path</span><span class="o">.</span><span class="n">home</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">FileExistsError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;We WILL NOT remove your &quot;</span>
                              <span class="sa">f</span><span class="s2">&quot;home directory $</span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">directory</span> <span class="o">==</span> <span class="n">_Path</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">FileExistsError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;We WILL NOT remove the root directory &quot;</span>
                              <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># get the directory containing &#39;$HOME&#39;</span>
    <span class="k">if</span> <span class="n">directory</span> <span class="o">==</span> <span class="n">_Path</span><span class="o">.</span><span class="n">home</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">FileExistsError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;We WILL NOT remove the users/home &quot;</span>
                              <span class="sa">f</span><span class="s2">&quot;directory </span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">directory</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
        <span class="n">directory</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>
        <span class="k">return</span>

    <span class="kn">from</span> <span class="nn">.utils._console</span> <span class="kn">import</span> <span class="n">Console</span>

    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">directory</span><span class="o">.</span><span class="n">iterdir</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
            <span class="n">_rmdir</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">item</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>

    <span class="n">Console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;removing directory </span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">)</span>
    <span class="n">directory</span><span class="o">.</span><span class="n">rmdir</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">_check_remove</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span> <span class="n">prompt</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function to check if the user wants to remove the directory,</span>
<span class="sd">       giving them the option to continue, quit or remove all files</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">prompt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">FileExistsError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cannot continue as </span><span class="si">{</span><span class="n">outdir</span><span class="si">}</span><span class="s2"> already exists!&quot;</span><span class="p">)</span>

    <span class="kn">from</span> <span class="nn">.utils._console</span> <span class="kn">import</span> <span class="n">Console</span>
    <span class="n">Console</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">outdir</span><span class="si">}</span><span class="s2"> already exists.&quot;</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">prompt</span><span class="p">(</span><span class="s2">&quot;Do you want to remove it? (y/n) &quot;</span><span class="p">)</span>

    <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">==</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span>
        <span class="n">Console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removing all files in </span><span class="si">{</span><span class="n">outdir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">)</span>
        <span class="n">_rmdir</span><span class="p">(</span><span class="n">_Path</span><span class="p">(</span><span class="n">outdir</span><span class="p">))</span>
        <span class="k">return</span>

    <span class="n">Console</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Continuing with this run will mix its output with &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;the files already in </span><span class="si">{</span><span class="n">outdir</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

    <span class="n">y</span> <span class="o">=</span> <span class="n">prompt</span><span class="p">(</span><span class="s2">&quot;Do you want to continue with this run? (y/n) &quot;</span><span class="p">)</span>

    <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">y</span> <span class="o">!=</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">.utils._console</span> <span class="kn">import</span> <span class="n">Console</span>
        <span class="n">Console</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Exiting the program as we cannot run any more.&quot;</span><span class="p">)</span>
        <span class="kn">import</span> <span class="nn">sys</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_force_remove</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span> <span class="n">prompt</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function to force the removal of a directory, using the</span>
<span class="sd">       passed prompt to double-check with the user. If &#39;prompt&#39;</span>
<span class="sd">       is None, then we go ahead</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">os</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">outdir</span><span class="p">):</span>
        <span class="k">return</span>

    <span class="kn">from</span> <span class="nn">.utils._console</span> <span class="kn">import</span> <span class="n">Console</span>

    <span class="k">if</span> <span class="n">prompt</span><span class="p">:</span>
        <span class="n">Console</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">outdir</span><span class="si">}</span><span class="s2"> already exists&quot;</span><span class="p">)</span>

        <span class="n">y</span> <span class="o">=</span> <span class="n">prompt</span><span class="p">(</span><span class="s2">&quot;Do you want to remove it? (y/n) &quot;</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">y</span> <span class="o">!=</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">FileExistsError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Cannot continue as </span><span class="si">{</span><span class="n">outdir</span><span class="si">}</span><span class="s2"> already exists&quot;</span><span class="p">)</span>

    <span class="n">Console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removing all files in </span><span class="si">{</span><span class="n">outdir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
    <span class="n">_rmdir</span><span class="p">(</span><span class="n">_Path</span><span class="p">(</span><span class="n">outdir</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">_expand</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Expand all variables and user indicators in the passed path&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">os</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expandvars</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">_bz2compress</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">bz2filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;bz2 compress &#39;filename&#39; to write &#39;bz2filename&#39;&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">filename</span> <span class="o">==</span> <span class="n">bz2filename</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cannot be equal </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2"> vs </span><span class="si">{</span><span class="n">bz2filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="kn">import</span> <span class="nn">bz2</span> <span class="k">as</span> <span class="nn">_bz2</span>

    <span class="n">compressor</span> <span class="o">=</span> <span class="n">_bz2</span><span class="o">.</span><span class="n">BZ2Compressor</span><span class="p">()</span>
    <span class="n">BLOCK_SIZE</span> <span class="o">=</span> <span class="mi">2048</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">bz2filename</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">BZ2FILE</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">FILE</span><span class="p">:</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">block</span> <span class="o">=</span> <span class="n">FILE</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">BLOCK_SIZE</span><span class="p">)</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">block</span><span class="p">:</span>
                    <span class="n">remaining</span> <span class="o">=</span> <span class="n">compressor</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
                    <span class="n">BZ2FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">remaining</span><span class="p">)</span>
                    <span class="k">return</span>

                <span class="n">compressed</span> <span class="o">=</span> <span class="n">compressor</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
                <span class="n">BZ2FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">compressed</span><span class="p">)</span>


<div class="viewcode-block" id="OutputFiles"><a class="viewcode-back" href="../../api/generated/metawards.OutputFiles.html#metawards.OutputFiles">[docs]</a><span class="k">class</span> <span class="nc">OutputFiles</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;This is a class that manages all of the output files that</span>
<span class="sd">       are written to during a model outbreak. This object is used</span>
<span class="sd">       to hold the &#39;FILE&#39; objects for open files, and will</span>
<span class="sd">       ensure that these files are closed and written to disk</span>
<span class="sd">       as needed. It will also ensure that files are written</span>
<span class="sd">       to the correct output directory, and that they are only</span>
<span class="sd">       opened when they are needed (e.g. only the first call</span>
<span class="sd">       to open the file will actually open it - subsequent</span>
<span class="sd">       calls will return the already-open file handler)</span>

<span class="sd">       Examples</span>
<span class="sd">       --------</span>
<span class="sd">       &gt;&gt;&gt; output = OutputFiles(output_dir=&quot;output&quot;, check_empty=True)</span>
<span class="sd">       &gt;&gt;&gt; FILE = output.open(&quot;output.txt&quot;)</span>
<span class="sd">       &gt;&gt;&gt; FILE.write(&quot;some output\\n&quot;)</span>
<span class="sd">       &gt;&gt;&gt; FILE = output.open(&quot;something.csv.bz2&quot;, auto_bzip=True)</span>
<span class="sd">       &gt;&gt;&gt; FILE.write(&quot;something,else,is,here\\n&quot;)</span>
<span class="sd">       &gt;&gt;&gt; output.flush()</span>
<span class="sd">       &gt;&gt;&gt; FILE = output.open(&quot;output.txt&quot;)</span>
<span class="sd">       &gt;&gt;&gt; FILE.write(&quot;some more output\\n&quot;)</span>
<span class="sd">       &gt;&gt;&gt; output.close()</span>

<span class="sd">       Note that you can also use OutputFiles in a contexthandler, to</span>
<span class="sd">       ensure that all output files are automatically closed, e.g.</span>

<span class="sd">       &gt;&gt;&gt; with OutputFiles(output_dir=&quot;output&quot;) as output:</span>
<span class="sd">       &gt;&gt;&gt;     FILE = output.open(&quot;output.txt&quot;)</span>
<span class="sd">       &gt;&gt;&gt;     FILE.write(&quot;something\\n&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="OutputFiles.__init__"><a class="viewcode-back" href="../../api/generated/metawards.OutputFiles.html#metawards.OutputFiles.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;output&quot;</span><span class="p">,</span>
                 <span class="n">check_empty</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                 <span class="n">force_empty</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="n">prompt</span><span class="o">=</span><span class="nb">input</span><span class="p">,</span>
                 <span class="n">auto_bzip</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Construct a set of OutputFiles. These will all be written</span>
<span class="sd">           to &#39;output_dir&#39;.</span>

<span class="sd">           Parameters</span>
<span class="sd">           ----------</span>
<span class="sd">           output_dir: str</span>
<span class="sd">             The directory in which to create all of the output files.</span>
<span class="sd">             This directory will be created automatically if it doesn&#39;t</span>
<span class="sd">             exist</span>
<span class="sd">           check_empty: bool</span>
<span class="sd">             Whether or not to check if the directory is empty before</span>
<span class="sd">             continuing. If the directory is not empty, then the user</span>
<span class="sd">             will be prompted to make a decision to either keep going,</span>
<span class="sd">             choose a different directory, remove existing output</span>
<span class="sd">             or exit</span>
<span class="sd">           force_empty: bool</span>
<span class="sd">             Force the output directory to be empty. BE CAREFUL as this</span>
<span class="sd">             will remove all files in that directory! There are checks</span>
<span class="sd">             to stop you doing something silly, but these are not</span>
<span class="sd">             fool-proof. The user will be prompted to confirm that</span>
<span class="sd">             the files should be removed</span>
<span class="sd">           prompt:</span>
<span class="sd">             This is the function that should be called to prompt the</span>
<span class="sd">             user for input, e.g. to confirm whether or not files</span>
<span class="sd">             should be deleted. This defaults to `input`. Set this</span>
<span class="sd">             to None if you *really* want MetaWards to remove files</span>
<span class="sd">             silently (e.g. useful if you are running batch jobs</span>
<span class="sd">             on a cluster and you really know what you are doing)</span>
<span class="sd">           auto_bzip: bool</span>
<span class="sd">             The default flag for `auto_bzip` when opening files. If</span>
<span class="sd">             this is true then all files will be automatically bzipped</span>
<span class="sd">             (compressed) as they are written, unless the code opening</span>
<span class="sd">             the file has explicitly asked otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_empty</span> <span class="o">=</span> <span class="n">_get_bool</span><span class="p">(</span><span class="n">check_empty</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_force_empty</span> <span class="o">=</span> <span class="n">_get_bool</span><span class="p">(</span><span class="n">force_empty</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_auto_bzip</span> <span class="o">=</span> <span class="n">_get_bool</span><span class="p">(</span><span class="n">auto_bzip</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_prompt</span> <span class="o">=</span> <span class="n">prompt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_output_dir</span> <span class="o">=</span> <span class="n">output_dir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_open</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_open_files</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filenames</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_database</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_open_dir</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_open_dir</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">exc_traceback</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_close_dir</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_open_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Internal function used to open the directory in which</span>
<span class="sd">           all output files will be placed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_open</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="kn">import</span> <span class="nn">os</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;You cannot open an empty OutputFiles!&quot;</span><span class="p">)</span>

        <span class="n">outdir</span> <span class="o">=</span> <span class="n">_expand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_output_dir</span><span class="p">)</span>

        <span class="n">mask</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">outdir</span><span class="p">):</span>
            <span class="n">outdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">outdir</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_empty</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">_is_empty</span><span class="p">(</span><span class="n">outdir</span><span class="p">):</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_force_empty</span><span class="p">:</span>
                        <span class="n">_force_remove</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prompt</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">_check_remove</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prompt</span><span class="p">)</span>

                    <span class="c1"># remake the directory after it has been removed</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="kn">import</span> <span class="nn">sys</span>

                        <span class="c1"># Make sure write bit is set on Windows.</span>
                        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s2">&quot;win32&quot;</span><span class="p">:</span>
                            <span class="c1"># Safely preserve the permissions of the</span>
                            <span class="c1"># current process</span>
                            <span class="kn">import</span> <span class="nn">stat</span>
                            <span class="n">mask</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">umask</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span> <span class="n">stat</span><span class="o">.</span><span class="n">S_IWRITE</span><span class="p">)</span>
                            <span class="n">os</span><span class="o">.</span><span class="n">umask</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
                            <span class="n">mask</span> <span class="o">=</span> <span class="kc">None</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">outdir</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">FileExistsError</span><span class="p">:</span>
                        <span class="k">pass</span>
                    <span class="k">finally</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">os</span><span class="o">.</span><span class="n">umask</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
                            <span class="n">mask</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">outdir</span><span class="p">):</span>
                <span class="kn">from</span> <span class="nn">.utils._console</span> <span class="kn">import</span> <span class="n">Console</span>
                <span class="n">Console</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Cannot open </span><span class="si">{</span><span class="n">outdir</span><span class="si">}</span><span class="s2"> as it is not a directory!&quot;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">FileExistsError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">outdir</span><span class="si">}</span><span class="s2"> is an existing file!&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">sys</span>

            <span class="c1"># Make sure write bit is set on Windows.</span>
            <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s2">&quot;win32&quot;</span><span class="p">:</span>
                <span class="c1"># Safely preserve the permissions of the current process</span>
                <span class="kn">import</span> <span class="nn">stat</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">umask</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span> <span class="n">stat</span><span class="o">.</span><span class="n">S_IWRITE</span><span class="p">)</span>
                <span class="n">os</span><span class="o">.</span><span class="n">umask</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">outdir</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">FileExistsError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># this is no problem, as we have already validated</span>
            <span class="c1"># that the directory already existing is ok</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">outdir</span><span class="p">):</span>
                <span class="c1"># but it is a problem if it is not a directory...</span>
                <span class="k">raise</span> <span class="n">e</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">umask</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_output_dir</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">_Path</span><span class="p">(</span><span class="n">outdir</span><span class="p">)</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span><span class="o">.</span><span class="n">resolve</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_is_open</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_close_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Internal function used to close all of the output files&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_open</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">filename</span><span class="p">,</span> <span class="n">handle</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_files</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_database</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                    <span class="n">handle</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                    <span class="n">handle</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filenames</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;bz2&quot;</span><span class="p">):</span>
                        <span class="c1"># we need to manually compress this file</span>
                        <span class="n">_bz2compress</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filenames</span><span class="p">[</span><span class="n">filename</span><span class="p">])</span>
                        <span class="kn">import</span> <span class="nn">os</span> <span class="k">as</span> <span class="nn">_os</span>
                        <span class="n">_os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">handle</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not close </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">: &quot;</span>
                              <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="vm">__class__</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_is_open</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_open_files</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filenames</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_database</span> <span class="o">=</span> <span class="p">{}</span>

<div class="viewcode-block" id="OutputFiles.is_database"><a class="viewcode-back" href="../../api/generated/metawards.OutputFiles.html#metawards.OutputFiles.is_database">[docs]</a>    <span class="k">def</span> <span class="nf">is_database</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return whether or not &#39;filename&#39; is an open database&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_database</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="OutputFiles.remove"><a class="viewcode-back" href="../../api/generated/metawards.OutputFiles.html#metawards.OutputFiles.remove">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">prompt</span><span class="o">=</span><span class="nb">input</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove the passed filename or directory</span>

<span class="sd">           Parameters</span>
<span class="sd">           ----------</span>
<span class="sd">           path: str</span>
<span class="sd">             The path to the file or directory or remove</span>
<span class="sd">           prompt:</span>
<span class="sd">             Prompt to use to ask the user - if None then no checks!</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">_Path</span><span class="p">(</span><span class="n">_expand</span><span class="p">(</span><span class="n">path</span><span class="p">))</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
        <span class="n">_force_remove</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">prompt</span><span class="p">)</span></div>

<div class="viewcode-block" id="OutputFiles.is_open"><a class="viewcode-back" href="../../api/generated/metawards.OutputFiles.html#metawards.OutputFiles.is_open">[docs]</a>    <span class="k">def</span> <span class="nf">is_open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return whether or not the output files are open&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_open</span></div>

<div class="viewcode-block" id="OutputFiles.is_closed"><a class="viewcode-back" href="../../api/generated/metawards.OutputFiles.html#metawards.OutputFiles.is_closed">[docs]</a>    <span class="k">def</span> <span class="nf">is_closed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return whether or not the output files are closed&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_open</span><span class="p">()</span></div>

<div class="viewcode-block" id="OutputFiles.output_dir"><a class="viewcode-back" href="../../api/generated/metawards.OutputFiles.html#metawards.OutputFiles.output_dir">[docs]</a>    <span class="k">def</span> <span class="nf">output_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the absolute path of the directory to which</span>
<span class="sd">           the output files will be written</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_dir</span></div>

<div class="viewcode-block" id="OutputFiles.open_db"><a class="viewcode-back" href="../../api/generated/metawards.OutputFiles.html#metawards.OutputFiles.open_db">[docs]</a>    <span class="k">def</span> <span class="nf">open_db</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">auto_bzip</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">initialise</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Open up a SQLite3 database connection to a file called</span>
<span class="sd">           &#39;filename&#39; in the output directory, returning the</span>
<span class="sd">           SQLite3 connection to the database. Note that this will</span>
<span class="sd">           open the database one, and will return the already-made</span>
<span class="sd">           connection on all subsequence calls.</span>

<span class="sd">           Parameters</span>
<span class="sd">           ----------</span>
<span class="sd">           filename: str</span>
<span class="sd">             The name of the file containing the database to open.</span>
<span class="sd">             This must be relative to the output directory, and within</span>
<span class="sd">             that directory. It is an error to try to open a database</span>
<span class="sd">             that is not contained in this directory.</span>
<span class="sd">           auto_bzip: bool</span>
<span class="sd">             Whether or not to automatically compress the file</span>
<span class="sd">             using bzip2 when it is closed. The filename will</span>
<span class="sd">             automatically have &#39;.bz2&#39; appended so that this</span>
<span class="sd">             is clear. If &#39;None&#39; is passed (the default) then</span>
<span class="sd">             the value of &#39;auto_bzip&#39; that was passed to the</span>
<span class="sd">             constructor of this OutputFiles will be used. Note that</span>
<span class="sd">             this flag is ignored if the database is already open</span>
<span class="sd">          initialise: function</span>
<span class="sd">             A function that is called to initialise the database the</span>
<span class="sd">             first time that it is opened. The function is called</span>
<span class="sd">             with the argument &quot;CONN&quot; (representing the sqlite3 database</span>
<span class="sd">             connection). Use this to create the tables that you need</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">os</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_open_dir</span><span class="p">()</span>

        <span class="n">outdir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_dir</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">_Path</span><span class="p">(</span><span class="n">_expand</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">p</span><span class="o">.</span><span class="n">is_absolute</span><span class="p">():</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">_Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span> <span class="n">filename</span><span class="p">))</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span><span class="o">.</span><span class="n">resolve</span><span class="p">())</span>

        <span class="n">prefix</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">commonprefix</span><span class="p">([</span><span class="n">outdir</span><span class="p">,</span> <span class="n">filename</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">prefix</span> <span class="o">!=</span> <span class="n">outdir</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;You cannot try to open </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2"> as &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;this is not in the output directory &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">outdir</span><span class="si">}</span><span class="s2"> - common prefix is </span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">filename</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_files</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_database</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_files</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2"> is a file, not a database!&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">auto_bzip</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">auto_bzip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auto_bzip</span>

        <span class="n">auto_bzip</span> <span class="o">=</span> <span class="n">_get_bool</span><span class="p">(</span><span class="n">auto_bzip</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">auto_bzip</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">auto_bzip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auto_bzip</span>

        <span class="n">auto_bzip</span> <span class="o">=</span> <span class="n">_get_bool</span><span class="p">(</span><span class="n">auto_bzip</span><span class="p">)</span>

        <span class="kn">import</span> <span class="nn">sqlite3</span> <span class="k">as</span> <span class="nn">_sqlite3</span>

        <span class="n">CONN</span> <span class="o">=</span> <span class="n">_sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">initialise</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">initialise</span><span class="p">(</span><span class="n">CONN</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_open_files</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="n">CONN</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_database</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">auto_bzip</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.bz2&quot;</span><span class="p">):</span>
                <span class="n">suffix</span> <span class="o">=</span> <span class="s2">&quot;.bz2&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">suffix</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_filenames</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}{</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_filenames</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="n">filename</span>

        <span class="k">return</span> <span class="n">CONN</span></div>

<div class="viewcode-block" id="OutputFiles.open"><a class="viewcode-back" href="../../api/generated/metawards.OutputFiles.html#metawards.OutputFiles.open">[docs]</a>    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">auto_bzip</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;t&quot;</span><span class="p">,</span>
             <span class="n">headers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Open the file called &#39;filename&#39; in the output directory,</span>
<span class="sd">           returning a handle to that file. Note that this will</span>
<span class="sd">           open the file once, and will return the already-open</span>
<span class="sd">           file handle on all subsequent calls.</span>

<span class="sd">           Parameters</span>
<span class="sd">           ----------</span>
<span class="sd">           filename: str</span>
<span class="sd">             The name of the file to open. This must be relative</span>
<span class="sd">             to the output directory, and within that directory.</span>
<span class="sd">             It is an error to try to open a file that is</span>
<span class="sd">             not contained within this directory.</span>
<span class="sd">           auto_bzip: bool</span>
<span class="sd">             Whether or not to open the file in auto-bzip (compression)</span>
<span class="sd">             mode. If this is True then the file will be automatically</span>
<span class="sd">             compressed as it is written. The filename will have</span>
<span class="sd">             &#39;.bz2&#39; automatically appended so that this is clear.</span>
<span class="sd">             If this is False then the file will be written uncompressed.</span>
<span class="sd">             If &#39;None&#39; is passed (the default) then the value of</span>
<span class="sd">             `auto_bzip` that was passed to the constructor of</span>
<span class="sd">             this OutputFiles will be used. Note that this flag is</span>
<span class="sd">             ignored if the file is already open.</span>
<span class="sd">           mode: str</span>
<span class="sd">             The mode of opening the file, e.g. &#39;t&#39; for text mode, and</span>
<span class="sd">             &#39;b&#39; for binary mode. The default is text mode</span>
<span class="sd">           headers: list[str] or plain str or function</span>
<span class="sd">             The headers to add to the top of the file, e.g. if it will</span>
<span class="sd">             contain column data. This will be written to the first line</span>
<span class="sd">             when the file is opened. If a list is passed, then this</span>
<span class="sd">             will be written joined together using &#39;sep&#39;. If a plain</span>
<span class="sd">             string is passed then this will be written. If this is a function</span>
<span class="sd">             then this function will be called with &quot;FILE&quot; as the argument.</span>
<span class="sd">             If nothing is passed then no headers will be written.</span>
<span class="sd">           sep: str</span>
<span class="sd">             The separator used for the headers (e.g. &quot; &quot; or &quot;,&quot; are good</span>
<span class="sd">             choices). By default things are space-separated</span>

<span class="sd">           Returns</span>
<span class="sd">           -------</span>
<span class="sd">           file</span>
<span class="sd">             The handle to the open file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">os</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_open_dir</span><span class="p">()</span>

        <span class="n">outdir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_dir</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">_Path</span><span class="p">(</span><span class="n">_expand</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">p</span><span class="o">.</span><span class="n">is_absolute</span><span class="p">():</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">_Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span> <span class="n">filename</span><span class="p">))</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span><span class="o">.</span><span class="n">resolve</span><span class="p">())</span>

        <span class="n">prefix</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">commonprefix</span><span class="p">([</span><span class="n">outdir</span><span class="p">,</span> <span class="n">filename</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">prefix</span> <span class="o">!=</span> <span class="n">outdir</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;You cannot try to open </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2"> as &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;this is not in the output directory &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">outdir</span><span class="si">}</span><span class="s2"> - common prefix is </span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">filename</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_files</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_database</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2"> is a database, not a file!&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_files</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">auto_bzip</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">auto_bzip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auto_bzip</span>

        <span class="n">auto_bzip</span> <span class="o">=</span> <span class="n">_get_bool</span><span class="p">(</span><span class="n">auto_bzip</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">mode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;w&quot;</span>
        <span class="k">elif</span> <span class="n">mode</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;w</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="n">mode</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="c1"># text file = encoding should be &quot;UTF-8&quot;</span>
            <span class="n">encoding</span> <span class="o">=</span> <span class="s2">&quot;UTF-8&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">encoding</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">auto_bzip</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">bz2</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.bz2&quot;</span><span class="p">):</span>
                <span class="n">suffix</span> <span class="o">=</span> <span class="s2">&quot;.bz2&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">suffix</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

            <span class="k">if</span> <span class="n">encoding</span><span class="p">:</span>
                <span class="n">FILE</span> <span class="o">=</span> <span class="n">bz2</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}{</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
                                <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">FILE</span> <span class="o">=</span> <span class="n">bz2</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}{</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_open_files</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="n">FILE</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_filenames</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}{</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">encoding</span><span class="p">:</span>
                <span class="n">FILE</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">FILE</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_open_files</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="n">FILE</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_filenames</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="n">filename</span>

        <span class="k">if</span> <span class="n">headers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">headers</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span>
                <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">headers</span><span class="p">,</span> <span class="s2">&quot;__call__&quot;</span><span class="p">):</span>
                <span class="n">headers</span><span class="p">(</span><span class="n">FILE</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">]))</span>
                <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">FILE</span></div>

<div class="viewcode-block" id="OutputFiles.open_subdir"><a class="viewcode-back" href="../../api/generated/metawards.OutputFiles.html#metawards.OutputFiles.open_subdir">[docs]</a>    <span class="k">def</span> <span class="nf">open_subdir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dirname</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create and open a sub-directory in this OutputFiles</span>
<span class="sd">           called &#39;dirname&#39;. This will inherit all properties,</span>
<span class="sd">           e.g. check_empty, auto_bzip etc from this OutputFiles</span>

<span class="sd">           Parameters</span>
<span class="sd">           ----------</span>
<span class="sd">           dirname: str</span>
<span class="sd">             The name of the subdirectory to open</span>

<span class="sd">           Returns</span>
<span class="sd">           -------</span>
<span class="sd">           subdir: OutputFiles</span>
<span class="sd">             The open subdirectory</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">os</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_open_dir</span><span class="p">()</span>

        <span class="n">outdir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_dir</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">_Path</span><span class="p">(</span><span class="n">_expand</span><span class="p">(</span><span class="n">dirname</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">p</span><span class="o">.</span><span class="n">is_absolute</span><span class="p">():</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">_Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span> <span class="n">dirname</span><span class="p">))</span>

        <span class="n">subdir</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span><span class="o">.</span><span class="n">resolve</span><span class="p">())</span>

        <span class="n">prefix</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">commonprefix</span><span class="p">([</span><span class="n">outdir</span><span class="p">,</span> <span class="n">subdir</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">prefix</span> <span class="o">!=</span> <span class="n">outdir</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;You cannot try to open </span><span class="si">{</span><span class="n">dirname</span><span class="si">}</span><span class="s2"> as &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;this is not in the output directory &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">outdir</span><span class="si">}</span><span class="s2"> - common prefix is </span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">OutputFiles</span><span class="p">(</span><span class="n">output_dir</span><span class="o">=</span><span class="n">subdir</span><span class="p">,</span> <span class="n">check_empty</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_check_empty</span><span class="p">,</span>
                           <span class="n">force_empty</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_force_empty</span><span class="p">,</span> <span class="n">prompt</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_prompt</span><span class="p">,</span>
                           <span class="n">auto_bzip</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_auto_bzip</span><span class="p">)</span></div>

<div class="viewcode-block" id="OutputFiles.auto_bzip"><a class="viewcode-back" href="../../api/generated/metawards.OutputFiles.html#metawards.OutputFiles.auto_bzip">[docs]</a>    <span class="k">def</span> <span class="nf">auto_bzip</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return whether the default is to automatically bzip2 files&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auto_bzip</span></div>

<div class="viewcode-block" id="OutputFiles.get_path"><a class="viewcode-back" href="../../api/generated/metawards.OutputFiles.html#metawards.OutputFiles.get_path">[docs]</a>    <span class="k">def</span> <span class="nf">get_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the full expanded path to this directory&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_dir</span></div>

<div class="viewcode-block" id="OutputFiles.get_filename"><a class="viewcode-back" href="../../api/generated/metawards.OutputFiles.html#metawards.OutputFiles.get_filename">[docs]</a>    <span class="k">def</span> <span class="nf">get_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the full expanded filename for &#39;filename&#39;&quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">os</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_open_dir</span><span class="p">()</span>

        <span class="n">outdir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_dir</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">_Path</span><span class="p">(</span><span class="n">_expand</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">p</span><span class="o">.</span><span class="n">is_absolute</span><span class="p">():</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">_Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span> <span class="n">filename</span><span class="p">))</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span><span class="o">.</span><span class="n">resolve</span><span class="p">())</span>

        <span class="k">if</span> <span class="n">filename</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filenames</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filenames</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No open file </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="OutputFiles.close"><a class="viewcode-back" href="../../api/generated/metawards.OutputFiles.html#metawards.OutputFiles.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Close all of the files and this directory&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_close_dir</span><span class="p">()</span></div>

<div class="viewcode-block" id="OutputFiles.flush"><a class="viewcode-back" href="../../api/generated/metawards.OutputFiles.html#metawards.OutputFiles.flush">[docs]</a>    <span class="k">def</span> <span class="nf">flush</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Flush the contents of all files to disk&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">filename</span><span class="p">,</span> <span class="n">handle</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_files</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">handle</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">pass</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
      <span class="lastupdated">
        Last updated on Feb 11, 2021.
      </span>

    </p>
  </div> 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>